!function(t){var e={};function i(n){if(e[n])return e[n].exports;var r=e[n]={i:n,l:!1,exports:{}};return t[n].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)i.d(n,r,function(e){return t[e]}.bind(null,r));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="/",i(i.s=29)}([function(t,e,i){t.exports="function"==typeof Array.from?Array.from:i(15)},function(t,e,i){var n=n||{REVISION:"ALPHA"};!function(t){"use strict";function e(t,e){return Math.random()*(e-t)+t}function i(t,e){for(var i=0,n=t.length;i<n;i++)if(t[i]===e)return!0;return!1}var n=!1,r=0,o=function(){if(n)return n=!1,r;var t=2*Math.random()-1,e=2*Math.random()-1,i=t*t+e*e;if(0==i||1<i)return o();var s=Math.sqrt(-2*Math.log(i)/i);return r=e*s,n=!0,t*s};t.randf=e,t.randi=function(t,e){return Math.floor(Math.random()*(e-t)+t)},t.randn=function(t,e){return t+o()*e},t.zeros=function(t){if(void 0===t||isNaN(t))return[];if("undefined"!=typeof ArrayBuffer)return new Float64Array(t);for(var e=new Array(t),i=0;i<t;i++)e[i]=0;return e},t.maxmin=function(t){if(0===t.length)return{};for(var e=t[0],i=t[0],n=0,r=0,o=t.length,s=1;s<o;s++)t[s]>e&&(e=t[s],n=s),t[s]<i&&(i=t[s],r=s);return{maxi:n,maxv:e,mini:r,minv:i,dv:e-i}},t.randperm=function(t){for(var e,i=t,n=0,r=[],o=0;o<t;o++)r[o]=o;for(;i--;)n=Math.floor(Math.random()*(i+1)),e=r[i],r[i]=r[n],r[n]=e;return r},t.weightedSample=function(t,i){for(var n=e(0,1),r=0,o=0,s=t.length;o<s;o++)if(n<(r+=i[o]))return t[o]},t.arrUnique=function(t){for(var e=[],n=0,r=t.length;n<r;n++)i(e,t[n])||e.push(t[n]);return e},t.arrContains=i,t.getopt=function(t,e,i){return void 0!==t[e]?t[e]:i}}(n),function(t){"use strict";function e(e,i,n,r){if("[object Array]"===Object.prototype.toString.call(e)){this.sx=1,this.sy=1,this.depth=e.length,this.w=t.zeros(this.depth),this.dw=t.zeros(this.depth);for(var o=0;o<this.depth;o++)this.w[o]=e[o]}else{var s=(this.sx=e)*(this.sy=i)*(this.depth=n);if(this.w=t.zeros(s),this.dw=t.zeros(s),void 0===r){var a=Math.sqrt(1/(e*i*n));for(o=0;o<s;o++)this.w[o]=t.randn(0,a)}else for(o=0;o<s;o++)this.w[o]=r}}e.prototype={get:function(t,e,i){var n=(this.sx*e+t)*this.depth+i;return this.w[n]},set:function(t,e,i,n){var r=(this.sx*e+t)*this.depth+i;this.w[r]=n},add:function(t,e,i,n){var r=(this.sx*e+t)*this.depth+i;this.w[r]+=n},get_grad:function(t,e,i){var n=(this.sx*e+t)*this.depth+i;return this.dw[n]},set_grad:function(t,e,i,n){var r=(this.sx*e+t)*this.depth+i;this.dw[r]=n},add_grad:function(t,e,i,n){var r=(this.sx*e+t)*this.depth+i;this.dw[r]+=n},cloneAndZero:function(){return new e(this.sx,this.sy,this.depth,0)},clone:function(){for(var t=new e(this.sx,this.sy,this.depth,0),i=this.w.length,n=0;n<i;n++)t.w[n]=this.w[n];return t},addFrom:function(t){for(var e=0;e<this.w.length;e++)this.w[e]+=t.w[e]},addFromScaled:function(t,e){for(var i=0;i<this.w.length;i++)this.w[i]+=e*t.w[i]},setConst:function(t){for(var e=0;e<this.w.length;e++)this.w[e]=t},toJSON:function(){var t={};return t.sx=this.sx,t.sy=this.sy,t.depth=this.depth,t.w=this.w,t},fromJSON:function(e){this.sx=e.sx,this.sy=e.sy,this.depth=e.depth;var i=this.sx*this.sy*this.depth;this.w=t.zeros(i),this.dw=t.zeros(i);for(var n=0;n<i;n++)this.w[n]=e.w[n]}},t.Vol=e}(n),function(t){"use strict";var e=t.Vol;t.augment=function(i,n,r,o,s){var a;if(void 0===s&&(s=!1),void 0===r&&(r=t.randi(0,i.sx-n)),void 0===o&&(o=t.randi(0,i.sy-n)),n!==i.sx||0!==r||0!==o){a=new e(n,n,i.depth,0);for(var u=0;u<n;u++)for(var h=0;h<n;h++)if(!(u+r<0||u+r>=i.sx||h+o<0||h+o>=i.sy))for(var l=0;l<i.depth;l++)a.set(u,h,l,i.get(u+r,h+o,l))}else a=i;if(s){var c=a.cloneAndZero();for(u=0;u<a.sx;u++)for(h=0;h<a.sy;h++)for(l=0;l<a.depth;l++)c.set(u,h,l,a.get(a.sx-u-1,h,l));a=c}return a},t.img_to_vol=function(t,i){void 0===i&&(i=!1);var n=document.createElement("canvas");n.width=t.width,n.height=t.height;var r=n.getContext("2d");try{r.drawImage(t,0,0)}catch(t){if("NS_ERROR_NOT_AVAILABLE"===t.name)return!1;throw t}try{var o=r.getImageData(0,0,n.width,n.height)}catch(t){if("IndexSizeError"===t.name)return!1;throw t}for(var s=o.data,a=t.width,u=t.height,h=[],l=0;l<s.length;l++)h.push(s[l]/255-.5);var c=new e(a,u,4,0);if(c.w=h,i){var d=new e(a,u,1,0);for(l=0;l<a;l++)for(var f=0;f<u;f++)d.set(l,f,0,c.get(l,f,0));c=d}return c}}(n),function(t){"use strict";function e(t){t=t||{},this.out_depth=t.filters,this.sx=t.sx,this.in_depth=t.in_depth,this.in_sx=t.in_sx,this.in_sy=t.in_sy,this.sy=void 0!==t.sy?t.sy:this.sx,this.stride=void 0!==t.stride?t.stride:1,this.pad=void 0!==t.pad?t.pad:0,this.l1_decay_mul=void 0!==t.l1_decay_mul?t.l1_decay_mul:0,this.l2_decay_mul=void 0!==t.l2_decay_mul?t.l2_decay_mul:1,this.out_sx=Math.floor((this.in_sx+2*this.pad-this.sx)/this.stride+1),this.out_sy=Math.floor((this.in_sy+2*this.pad-this.sy)/this.stride+1),this.layer_type="conv";var e=void 0!==t.bias_pref?t.bias_pref:0;this.filters=[];for(var n=0;n<this.out_depth;n++)this.filters.push(new i(this.sx,this.sy,this.in_depth));this.biases=new i(1,1,this.out_depth,e)}var i=t.Vol;function n(t){t=t||{},this.out_depth=void 0!==t.num_neurons?t.num_neurons:t.filters,this.l1_decay_mul=void 0!==t.l1_decay_mul?t.l1_decay_mul:0,this.l2_decay_mul=void 0!==t.l2_decay_mul?t.l2_decay_mul:1,this.num_inputs=t.in_sx*t.in_sy*t.in_depth,this.out_sx=1,this.out_sy=1,this.layer_type="fc";var e=void 0!==t.bias_pref?t.bias_pref:0;this.filters=[];for(var n=0;n<this.out_depth;n++)this.filters.push(new i(1,1,this.num_inputs));this.biases=new i(1,1,this.out_depth,e)}e.prototype={forward:function(t,e){this.in_act=t;for(var n=new i(this.out_sx,this.out_sy,this.out_depth,0),r=0;r<this.out_depth;r++)for(var o=this.filters[r],s=-this.pad,a=-this.pad,u=0;u<this.out_sx;s+=this.stride,u++){a=-this.pad;for(var h=0;h<this.out_sy;a+=this.stride,h++){for(var l=0,c=0;c<o.sx;c++)for(var d=0;d<o.sy;d++)for(var f=0;f<o.depth;f++){var p=a+d,m=s+c;0<=p&&p<t.sy&&0<=m&&m<t.sx&&(l+=o.w[(o.sx*d+c)*o.depth+f]*t.w[(t.sx*p+m)*t.depth+f])}l+=this.biases.w[r],n.set(u,h,r,l)}}return this.out_act=n,this.out_act},backward:function(){var e=this.in_act;e.dw=t.zeros(e.w.length);for(var i=0;i<this.out_depth;i++)for(var n=this.filters[i],r=-this.pad,o=-this.pad,s=0;s<this.out_sx;r+=this.stride,s++){o=-this.pad;for(var a=0;a<this.out_sy;o+=this.stride,a++){for(var u=this.out_act.get_grad(s,a,i),h=0;h<n.sx;h++)for(var l=0;l<n.sy;l++)for(var c=0;c<n.depth;c++){var d=o+l,f=r+h;if(0<=d&&d<e.sy&&0<=f&&f<e.sx){var p=(e.sx*d+f)*e.depth+c,m=(n.sx*l+h)*n.depth+c;n.dw[m]+=e.w[p]*u,e.dw[p]+=n.w[m]*u}}this.biases.dw[i]+=u}}},getParamsAndGrads:function(){for(var t=[],e=0;e<this.out_depth;e++)t.push({params:this.filters[e].w,grads:this.filters[e].dw,l2_decay_mul:this.l2_decay_mul,l1_decay_mul:this.l1_decay_mul});return t.push({params:this.biases.w,grads:this.biases.dw,l1_decay_mul:0,l2_decay_mul:0}),t},toJSON:function(){var t={};t.sx=this.sx,t.sy=this.sy,t.stride=this.stride,t.in_depth=this.in_depth,t.out_depth=this.out_depth,t.out_sx=this.out_sx,t.out_sy=this.out_sy,t.layer_type=this.layer_type,t.l1_decay_mul=this.l1_decay_mul,t.l2_decay_mul=this.l2_decay_mul,t.pad=this.pad,t.filters=[];for(var e=0;e<this.filters.length;e++)t.filters.push(this.filters[e].toJSON());return t.biases=this.biases.toJSON(),t},fromJSON:function(t){this.out_depth=t.out_depth,this.out_sx=t.out_sx,this.out_sy=t.out_sy,this.layer_type=t.layer_type,this.sx=t.sx,this.sy=t.sy,this.stride=t.stride,this.in_depth=t.in_depth,this.filters=[],this.l1_decay_mul=void 0!==t.l1_decay_mul?t.l1_decay_mul:1,this.l2_decay_mul=void 0!==t.l2_decay_mul?t.l2_decay_mul:1,this.pad=void 0!==t.pad?t.pad:0;for(var e=0;e<t.filters.length;e++){var n=new i(0,0,0,0);n.fromJSON(t.filters[e]),this.filters.push(n)}this.biases=new i(0,0,0,0),this.biases.fromJSON(t.biases)}},n.prototype={forward:function(t,e){this.in_act=t;for(var n=new i(1,1,this.out_depth,0),r=t.w,o=0;o<this.out_depth;o++){for(var s=0,a=this.filters[o].w,u=0;u<this.num_inputs;u++)s+=r[u]*a[u];s+=this.biases.w[o],n.w[o]=s}return this.out_act=n,this.out_act},backward:function(){var e=this.in_act;e.dw=t.zeros(e.w.length);for(var i=0;i<this.out_depth;i++){for(var n=this.filters[i],r=this.out_act.dw[i],o=0;o<this.num_inputs;o++)e.dw[o]+=n.w[o]*r,n.dw[o]+=e.w[o]*r;this.biases.dw[i]+=r}},getParamsAndGrads:function(){for(var t=[],e=0;e<this.out_depth;e++)t.push({params:this.filters[e].w,grads:this.filters[e].dw,l1_decay_mul:this.l1_decay_mul,l2_decay_mul:this.l2_decay_mul});return t.push({params:this.biases.w,grads:this.biases.dw,l1_decay_mul:0,l2_decay_mul:0}),t},toJSON:function(){var t={};t.out_depth=this.out_depth,t.out_sx=this.out_sx,t.out_sy=this.out_sy,t.layer_type=this.layer_type,t.num_inputs=this.num_inputs,t.l1_decay_mul=this.l1_decay_mul,t.l2_decay_mul=this.l2_decay_mul,t.filters=[];for(var e=0;e<this.filters.length;e++)t.filters.push(this.filters[e].toJSON());return t.biases=this.biases.toJSON(),t},fromJSON:function(t){this.out_depth=t.out_depth,this.out_sx=t.out_sx,this.out_sy=t.out_sy,this.layer_type=t.layer_type,this.num_inputs=t.num_inputs,this.l1_decay_mul=void 0!==t.l1_decay_mul?t.l1_decay_mul:1,this.l2_decay_mul=void 0!==t.l2_decay_mul?t.l2_decay_mul:1,this.filters=[];for(var e=0;e<t.filters.length;e++){var n=new i(0,0,0,0);n.fromJSON(t.filters[e]),this.filters.push(n)}this.biases=new i(0,0,0,0),this.biases.fromJSON(t.biases)}},t.ConvLayer=e,t.FullyConnLayer=n}(n),function(t){"use strict";function e(e){e=e||{},this.sx=e.sx,this.in_depth=e.in_depth,this.in_sx=e.in_sx,this.in_sy=e.in_sy,this.sy=void 0!==e.sy?e.sy:this.sx,this.stride=void 0!==e.stride?e.stride:2,this.pad=void 0!==e.pad?e.pad:0,this.out_depth=this.in_depth,this.out_sx=Math.floor((this.in_sx+2*this.pad-this.sx)/this.stride+1),this.out_sy=Math.floor((this.in_sy+2*this.pad-this.sy)/this.stride+1),this.layer_type="pool",this.switchx=t.zeros(this.out_sx*this.out_sy*this.out_depth),this.switchy=t.zeros(this.out_sx*this.out_sy*this.out_depth)}var i=t.Vol;e.prototype={forward:function(t,e){this.in_act=t;for(var n=new i(this.out_sx,this.out_sy,this.out_depth,0),r=0,o=0;o<this.out_depth;o++)for(var s=-this.pad,a=-this.pad,u=0;u<this.out_sx;s+=this.stride,u++){a=-this.pad;for(var h=0;h<this.out_sy;a+=this.stride,h++){for(var l=-99999,c=-1,d=-1,f=0;f<this.sx;f++)for(var p=0;p<this.sy;p++){var m=a+p,_=s+f;if(0<=m&&m<t.sy&&0<=_&&_<t.sx){var v=t.get(_,m,o);l<v&&(l=v,c=_,d=m)}}this.switchx[r]=c,this.switchy[r]=d,r++,n.set(u,h,o,l)}}return this.out_act=n,this.out_act},backward:function(){var e=this.in_act;e.dw=t.zeros(e.w.length),this.out_act;for(var i=0,n=0;n<this.out_depth;n++){this.pad,this.pad;for(var r=0;r<this.out_sx;this.stride,r++){this.pad;for(var o=0;o<this.out_sy;this.stride,o++){var s=this.out_act.get_grad(r,o,n);e.add_grad(this.switchx[i],this.switchy[i],n,s),i++}}}},getParamsAndGrads:function(){return[]},toJSON:function(){var t={};return t.sx=this.sx,t.sy=this.sy,t.stride=this.stride,t.in_depth=this.in_depth,t.out_depth=this.out_depth,t.out_sx=this.out_sx,t.out_sy=this.out_sy,t.layer_type=this.layer_type,t.pad=this.pad,t},fromJSON:function(e){this.out_depth=e.out_depth,this.out_sx=e.out_sx,this.out_sy=e.out_sy,this.layer_type=e.layer_type,this.sx=e.sx,this.sy=e.sy,this.stride=e.stride,this.in_depth=e.in_depth,this.pad=void 0!==e.pad?e.pad:0,this.switchx=t.zeros(this.out_sx*this.out_sy*this.out_depth),this.switchy=t.zeros(this.out_sx*this.out_sy*this.out_depth)}},t.PoolLayer=e}(n),function(t){"use strict";function e(t){t=t||{},this.out_sx=void 0!==t.out_sx?t.out_sx:t.in_sx,this.out_sy=void 0!==t.out_sy?t.out_sy:t.in_sy,this.out_depth=void 0!==t.out_depth?t.out_depth:t.in_depth,this.layer_type="input"}t.Vol,e.prototype={forward:function(t,e){return this.in_act=t,this.out_act=t,this.out_act},backward:function(){},getParamsAndGrads:function(){return[]},toJSON:function(){var t={};return t.out_depth=this.out_depth,t.out_sx=this.out_sx,t.out_sy=this.out_sy,t.layer_type=this.layer_type,t},fromJSON:function(t){this.out_depth=t.out_depth,this.out_sx=t.out_sx,this.out_sy=t.out_sy,this.layer_type=t.layer_type}},t.InputLayer=e}(n),function(t){"use strict";function e(t){t=t||{},this.num_inputs=t.in_sx*t.in_sy*t.in_depth,this.out_depth=this.num_inputs,this.out_sx=1,this.out_sy=1,this.layer_type="softmax"}var i=t.Vol;function n(t){t=t||{},this.num_inputs=t.in_sx*t.in_sy*t.in_depth,this.out_depth=this.num_inputs,this.out_sx=1,this.out_sy=1,this.layer_type="regression"}function r(t){t=t||{},this.num_inputs=t.in_sx*t.in_sy*t.in_depth,this.out_depth=this.num_inputs,this.out_sx=1,this.out_sy=1,this.layer_type="svm"}e.prototype={forward:function(e,n){this.in_act=e;for(var r=new i(1,1,this.out_depth,0),o=e.w,s=e.w[0],a=1;a<this.out_depth;a++)o[a]>s&&(s=o[a]);var u=t.zeros(this.out_depth),h=0;for(a=0;a<this.out_depth;a++){var l=Math.exp(o[a]-s);h+=l,u[a]=l}for(a=0;a<this.out_depth;a++)u[a]/=h,r.w[a]=u[a];return this.es=u,this.out_act=r,this.out_act},backward:function(e){var i=this.in_act;i.dw=t.zeros(i.w.length);for(var n=0;n<this.out_depth;n++){var r=-((n===e?1:0)-this.es[n]);i.dw[n]=r}return-Math.log(this.es[e])},getParamsAndGrads:function(){return[]},toJSON:function(){var t={};return t.out_depth=this.out_depth,t.out_sx=this.out_sx,t.out_sy=this.out_sy,t.layer_type=this.layer_type,t.num_inputs=this.num_inputs,t},fromJSON:function(t){this.out_depth=t.out_depth,this.out_sx=t.out_sx,this.out_sy=t.out_sy,this.layer_type=t.layer_type,this.num_inputs=t.num_inputs}},n.prototype={forward:function(t,e){return this.in_act=t,this.out_act=t},backward:function(e){var i=this.in_act;i.dw=t.zeros(i.w.length);var n=0;if(e instanceof Array||e instanceof Float64Array)for(var r=0;r<this.out_depth;r++){var o=i.w[r]-e[r];n+=2*(i.dw[r]=o)*o}else{r=e.dim;var s=e.val;o=i.w[r]-s,n+=2*(i.dw[r]=o)*o}return n},getParamsAndGrads:function(){return[]},toJSON:function(){var t={};return t.out_depth=this.out_depth,t.out_sx=this.out_sx,t.out_sy=this.out_sy,t.layer_type=this.layer_type,t.num_inputs=this.num_inputs,t},fromJSON:function(t){this.out_depth=t.out_depth,this.out_sx=t.out_sx,this.out_sy=t.out_sy,this.layer_type=t.layer_type,this.num_inputs=t.num_inputs}},r.prototype={forward:function(t,e){return this.in_act=t,this.out_act=t},backward:function(e){var i=this.in_act;i.dw=t.zeros(i.w.length);for(var n=i.w[e],r=0,o=0;o<this.out_depth;o++)0<-n+i.w[o]+1&&(i.dw[o]+=1,--i.dw[e],r+=-n+i.w[o]+1);return r},getParamsAndGrads:function(){return[]},toJSON:function(){var t={};return t.out_depth=this.out_depth,t.out_sx=this.out_sx,t.out_sy=this.out_sy,t.layer_type=this.layer_type,t.num_inputs=this.num_inputs,t},fromJSON:function(t){this.out_depth=t.out_depth,this.out_sx=t.out_sx,this.out_sy=t.out_sy,this.layer_type=t.layer_type,this.num_inputs=t.num_inputs}},t.RegressionLayer=n,t.SoftmaxLayer=e,t.SVMLayer=r}(n),function(t){"use strict";function e(t){t=t||{},this.out_sx=t.in_sx,this.out_sy=t.in_sy,this.out_depth=t.in_depth,this.layer_type="relu"}var i=t.Vol;function n(t){t=t||{},this.out_sx=t.in_sx,this.out_sy=t.in_sy,this.out_depth=t.in_depth,this.layer_type="sigmoid"}function r(e){e=e||{},this.group_size=void 0!==e.group_size?e.group_size:2,this.out_sx=e.in_sx,this.out_sy=e.in_sy,this.out_depth=Math.floor(e.in_depth/this.group_size),this.layer_type="maxout",this.switches=t.zeros(this.out_sx*this.out_sy*this.out_depth)}function o(t){var e=Math.exp(2*t);return(e-1)/(e+1)}function s(t){t=t||{},this.out_sx=t.in_sx,this.out_sy=t.in_sy,this.out_depth=t.in_depth,this.layer_type="tanh"}e.prototype={forward:function(t,e){for(var i=(this.in_act=t).clone(),n=t.w.length,r=i.w,o=0;o<n;o++)r[o]<0&&(r[o]=0);return this.out_act=i,this.out_act},backward:function(){var e=this.in_act,i=this.out_act,n=e.w.length;e.dw=t.zeros(n);for(var r=0;r<n;r++)i.w[r]<=0?e.dw[r]=0:e.dw[r]=i.dw[r]},getParamsAndGrads:function(){return[]},toJSON:function(){var t={};return t.out_depth=this.out_depth,t.out_sx=this.out_sx,t.out_sy=this.out_sy,t.layer_type=this.layer_type,t},fromJSON:function(t){this.out_depth=t.out_depth,this.out_sx=t.out_sx,this.out_sy=t.out_sy,this.layer_type=t.layer_type}},n.prototype={forward:function(t,e){for(var i=(this.in_act=t).cloneAndZero(),n=t.w.length,r=i.w,o=t.w,s=0;s<n;s++)r[s]=1/(1+Math.exp(-o[s]));return this.out_act=i,this.out_act},backward:function(){var e=this.in_act,i=this.out_act,n=e.w.length;e.dw=t.zeros(n);for(var r=0;r<n;r++){var o=i.w[r];e.dw[r]=o*(1-o)*i.dw[r]}},getParamsAndGrads:function(){return[]},toJSON:function(){var t={};return t.out_depth=this.out_depth,t.out_sx=this.out_sx,t.out_sy=this.out_sy,t.layer_type=this.layer_type,t},fromJSON:function(t){this.out_depth=t.out_depth,this.out_sx=t.out_sx,this.out_sy=t.out_sy,this.layer_type=t.layer_type}},r.prototype={forward:function(t,e){this.in_act=t;var n=this.out_depth,r=new i(this.out_sx,this.out_sy,this.out_depth,0);if(1===this.out_sx&&1===this.out_sy)for(var o=0;o<n;o++){for(var s=o*this.group_size,a=t.w[s],u=0,h=1;h<this.group_size;h++)a<(f=t.w[s+h])&&(a=f,u=h);r.w[o]=a,this.switches[o]=s+u}else for(var l=0,c=0;c<t.sx;c++)for(var d=0;d<t.sy;d++)for(o=0;o<n;o++){for(s=o*this.group_size,a=t.get(c,d,s),u=0,h=1;h<this.group_size;h++){var f;a<(f=t.get(c,d,s+h))&&(a=f,u=h)}r.set(c,d,o,a),this.switches[l]=s+u,l++}return this.out_act=r,this.out_act},backward:function(){var e=this.in_act,i=this.out_act,n=this.out_depth;if(e.dw=t.zeros(e.w.length),1===this.out_sx&&1===this.out_sy)for(var r=0;r<n;r++){var o=i.dw[r];e.dw[this.switches[r]]=o}else for(var s=0,a=0;a<i.sx;a++)for(var u=0;u<i.sy;u++)for(r=0;r<n;r++)o=i.get_grad(a,u,r),e.set_grad(a,u,this.switches[s],o),s++},getParamsAndGrads:function(){return[]},toJSON:function(){var t={};return t.out_depth=this.out_depth,t.out_sx=this.out_sx,t.out_sy=this.out_sy,t.layer_type=this.layer_type,t.group_size=this.group_size,t},fromJSON:function(e){this.out_depth=e.out_depth,this.out_sx=e.out_sx,this.out_sy=e.out_sy,this.layer_type=e.layer_type,this.group_size=e.group_size,this.switches=t.zeros(this.group_size)}},s.prototype={forward:function(t,e){for(var i=(this.in_act=t).cloneAndZero(),n=t.w.length,r=0;r<n;r++)i.w[r]=o(t.w[r]);return this.out_act=i,this.out_act},backward:function(){var e=this.in_act,i=this.out_act,n=e.w.length;e.dw=t.zeros(n);for(var r=0;r<n;r++){var o=i.w[r];e.dw[r]=(1-o*o)*i.dw[r]}},getParamsAndGrads:function(){return[]},toJSON:function(){var t={};return t.out_depth=this.out_depth,t.out_sx=this.out_sx,t.out_sy=this.out_sy,t.layer_type=this.layer_type,t},fromJSON:function(t){this.out_depth=t.out_depth,this.out_sx=t.out_sx,this.out_sy=t.out_sy,this.layer_type=t.layer_type}},t.TanhLayer=s,t.MaxoutLayer=r,t.ReluLayer=e,t.SigmoidLayer=n}(n),function(t){"use strict";function e(e){e=e||{},this.out_sx=e.in_sx,this.out_sy=e.in_sy,this.out_depth=e.in_depth,this.layer_type="dropout",this.drop_prob=void 0!==e.drop_prob?e.drop_prob:.5,this.dropped=t.zeros(this.out_sx*this.out_sy*this.out_depth)}t.Vol,e.prototype={forward:function(t,e){void 0===e&&(e=!1);var i=(this.in_act=t).clone(),n=t.w.length;if(e)for(var r=0;r<n;r++)Math.random()<this.drop_prob?(i.w[r]=0,this.dropped[r]=!0):this.dropped[r]=!1;else for(r=0;r<n;r++)i.w[r]*=this.drop_prob;return this.out_act=i,this.out_act},backward:function(){var e=this.in_act,i=this.out_act,n=e.w.length;e.dw=t.zeros(n);for(var r=0;r<n;r++)this.dropped[r]||(e.dw[r]=i.dw[r])},getParamsAndGrads:function(){return[]},toJSON:function(){var t={};return t.out_depth=this.out_depth,t.out_sx=this.out_sx,t.out_sy=this.out_sy,t.layer_type=this.layer_type,t.drop_prob=this.drop_prob,t},fromJSON:function(t){this.out_depth=t.out_depth,this.out_sx=t.out_sx,this.out_sy=t.out_sy,this.layer_type=t.layer_type,this.drop_prob=t.drop_prob}},t.DropoutLayer=e}(n),function(t){"use strict";function e(t){t=t||{},this.k=t.k,this.n=t.n,this.alpha=t.alpha,this.beta=t.beta,this.out_sx=t.in_sx,this.out_sy=t.in_sy,this.out_depth=t.in_depth,this.layer_type="lrn",this.n}t.Vol,e.prototype={forward:function(t,e){var i=(this.in_act=t).cloneAndZero();this.S_cache_=t.cloneAndZero();for(var n=Math.floor(this.n/2),r=0;r<t.sx;r++)for(var o=0;o<t.sy;o++)for(var s=0;s<t.depth;s++){for(var a=t.get(r,o,s),u=0,h=Math.max(0,s-n);h<=Math.min(s+n,t.depth-1);h++){var l=t.get(r,o,h);u+=l*l}u*=this.alpha/this.n,u+=this.k,this.S_cache_.set(r,o,s,u),u=Math.pow(u,this.beta),i.set(r,o,s,a/u)}return this.out_act=i,this.out_act},backward:function(){var e=this.in_act;e.dw=t.zeros(e.w.length),this.out_act;for(var i=Math.floor(this.n/2),n=0;n<e.sx;n++)for(var r=0;r<e.sy;r++)for(var o=0;o<e.depth;o++)for(var s=this.out_act.get_grad(n,r,o),a=this.S_cache_.get(n,r,o),u=Math.pow(a,this.beta),h=u*u,l=Math.max(0,o-i);l<=Math.min(o+i,e.depth-1);l++){var c=e.get(n,r,l),d=-c*this.beta*Math.pow(a,this.beta-1)*this.alpha/this.n*2*c;l===o&&(d+=u),d/=h,d*=s,e.add_grad(n,r,l,d)}},getParamsAndGrads:function(){return[]},toJSON:function(){var t={};return t.k=this.k,t.n=this.n,t.alpha=this.alpha,t.beta=this.beta,t.out_sx=this.out_sx,t.out_sy=this.out_sy,t.out_depth=this.out_depth,t.layer_type=this.layer_type,t},fromJSON:function(t){this.k=t.k,this.n=t.n,this.alpha=t.alpha,this.beta=t.beta,this.out_sx=t.out_sx,this.out_sy=t.out_sy,this.out_depth=t.out_depth,this.layer_type=t.layer_type}},t.LocalResponseNormalizationLayer=e}(n),function(t){"use strict";function e(t){t=t||{},this.out_sx=t.in_sx,this.out_sy=t.in_sy,this.out_depth=t.in_depth+t.in_depth*t.in_depth,this.layer_type="quadtransform"}var i=t.Vol;e.prototype={forward:function(t,e){this.in_act=t;for(var n=this.out_depth,r=t.depth,o=new i(this.out_sx,this.out_sy,this.out_depth,0),s=0;s<t.sx;s++)for(var a=0;a<t.sy;a++)for(var u=0;u<n;u++)if(u<r)o.set(s,a,u,t.get(s,a,u));else{var h=Math.floor((u-r)/r),l=u-r-h*r;o.set(s,a,u,t.get(s,a,h)*t.get(s,a,l))}return this.out_act=o,this.out_act},backward:function(){var e=this.in_act;e.dw=t.zeros(e.w.length);for(var i=this.out_act,n=this.out_depth,r=e.depth,o=0;o<e.sx;o++)for(var s=0;s<e.sy;s++)for(var a=0;a<n;a++){var u=i.get_grad(o,s,a);if(a<r)e.add_grad(o,s,a,u);else{var h=Math.floor((a-r)/r),l=a-r-h*r;e.add_grad(o,s,h,e.get(o,s,l)*u),e.add_grad(o,s,l,e.get(o,s,h)*u)}}},getParamsAndGrads:function(){return[]},toJSON:function(){var t={};return t.out_depth=this.out_depth,t.out_sx=this.out_sx,t.out_sy=this.out_sy,t.layer_type=this.layer_type,t},fromJSON:function(t){this.out_depth=t.out_depth,this.out_sx=t.out_sx,this.out_sy=t.out_sy,this.layer_type=t.layer_type}},t.QuadTransformLayer=e}(n),function(t){"use strict";function e(t){this.layers=[]}t.Vol,e.prototype={makeLayers:function(e){e.length,e[0].type,e=function(){for(var t=[],i=0;i<e.length;i++){var n=e[i];if("softmax"!==n.type&&"svm"!==n.type||t.push({type:"fc",num_neurons:n.num_classes}),"regression"===n.type&&t.push({type:"fc",num_neurons:n.num_neurons}),"fc"!==n.type&&"conv"!==n.type||void 0!==n.bias_pref||void(n.bias_pref=0)!==n.activation&&"relu"===n.activation&&(n.bias_pref=.1),void 0!==n.tensor&&n.tensor&&t.push({type:"quadtransform"}),t.push(n),void 0!==n.activation)if("relu"===n.activation)t.push({type:"relu"});else if("sigmoid"===n.activation)t.push({type:"sigmoid"});else if("tanh"===n.activation)t.push({type:"tanh"});else if("maxout"===n.activation){var r="undefined"!==n.group_size?n.group_size:2;t.push({type:"maxout",group_size:r})}void 0!==n.drop_prob&&"dropout"!==n.type&&t.push({type:"dropout",drop_prob:n.drop_prob})}return t}(),this.layers=[];for(var i=0;i<e.length;i++){var n=e[i];if(0<i){var r=this.layers[i-1];n.in_sx=r.out_sx,n.in_sy=r.out_sy,n.in_depth=r.out_depth}switch(n.type){case"fc":this.layers.push(new t.FullyConnLayer(n));break;case"lrn":this.layers.push(new t.LocalResponseNormalizationLayer(n));break;case"dropout":this.layers.push(new t.DropoutLayer(n));break;case"input":this.layers.push(new t.InputLayer(n));break;case"softmax":this.layers.push(new t.SoftmaxLayer(n));break;case"regression":this.layers.push(new t.RegressionLayer(n));break;case"conv":this.layers.push(new t.ConvLayer(n));break;case"pool":this.layers.push(new t.PoolLayer(n));break;case"relu":this.layers.push(new t.ReluLayer(n));break;case"sigmoid":this.layers.push(new t.SigmoidLayer(n));break;case"tanh":this.layers.push(new t.TanhLayer(n));break;case"maxout":this.layers.push(new t.MaxoutLayer(n));break;case"quadtransform":this.layers.push(new t.QuadTransformLayer(n));break;case"svm":this.layers.push(new t.SVMLayer(n))}}},forward:function(t,e){void 0===e&&(e=!1);for(var i=this.layers[0].forward(t,e),n=1;n<this.layers.length;n++)i=this.layers[n].forward(i,e);return i},backward:function(t){for(var e=this.layers.length,i=this.layers[e-1].backward(t),n=e-2;0<=n;n--)this.layers[n].backward();return i},getParamsAndGrads:function(){for(var t=[],e=0;e<this.layers.length;e++)for(var i=this.layers[e].getParamsAndGrads(),n=0;n<i.length;n++)t.push(i[n]);return t},getPrediction:function(){for(var t=this.layers[this.layers.length-1].out_act.w,e=t[0],i=0,n=1;n<t.length;n++)t[n]>e&&(e=t[n],i=n);return i},toJSON:function(){for(var t={layers:[]},e=0;e<this.layers.length;e++)t.layers.push(this.layers[e].toJSON());return t},fromJSON:function(e){this.layers=[];for(var i=0;i<e.layers.length;i++){var n,r=e.layers[i],o=r.layer_type;"input"===o&&(n=new t.InputLayer),"relu"===o&&(n=new t.ReluLayer),"sigmoid"===o&&(n=new t.SigmoidLayer),"tanh"===o&&(n=new t.TanhLayer),"dropout"===o&&(n=new t.DropoutLayer),"conv"===o&&(n=new t.ConvLayer),"pool"===o&&(n=new t.PoolLayer),"lrn"===o&&(n=new t.LocalResponseNormalizationLayer),"softmax"===o&&(n=new t.SoftmaxLayer),"regression"===o&&(n=new t.RegressionLayer),"fc"===o&&(n=new t.FullyConnLayer),"maxout"===o&&(n=new t.MaxoutLayer),"quadtransform"===o&&(n=new t.QuadTransformLayer),"svm"===o&&(n=new t.SVMLayer),n.fromJSON(r),this.layers.push(n)}}},t.Net=e}(n),function(t){"use strict";function e(t,e){this.net=t,e=e||{},this.learning_rate=void 0!==e.learning_rate?e.learning_rate:.01,this.l1_decay=void 0!==e.l1_decay?e.l1_decay:0,this.l2_decay=void 0!==e.l2_decay?e.l2_decay:0,this.batch_size=void 0!==e.batch_size?e.batch_size:1,this.method=void 0!==e.method?e.method:"sgd",this.momentum=void 0!==e.momentum?e.momentum:.9,this.ro=void 0!==e.ro?e.ro:.95,this.eps=void 0!==e.eps?e.eps:1e-6,this.k=0,this.gsum=[],this.xsum=[]}t.Vol,e.prototype={train:function(e,i){var n=(new Date).getTime();this.net.forward(e,!0);var r=(new Date).getTime()-n,o=(n=(new Date).getTime(),this.net.backward(i)),s=0,a=0,u=(new Date).getTime()-n;if(this.k++,this.k%this.batch_size==0){var h=this.net.getParamsAndGrads();if(0===this.gsum.length&&("sgd"!==this.method||0<this.momentum))for(var l=0;l<h.length;l++)this.gsum.push(t.zeros(h[l].params.length)),"adadelta"===this.method?this.xsum.push(t.zeros(h[l].params.length)):this.xsum.push([]);for(l=0;l<h.length;l++)for(var c=h[l],d=c.params,f=c.grads,p=void 0!==c.l2_decay_mul?c.l2_decay_mul:1,m=void 0!==c.l1_decay_mul?c.l1_decay_mul:1,_=this.l2_decay*p,v=this.l1_decay*m,y=d.length,g=0;g<y;g++){s+=_*d[g]*d[g]/2,a+=v*Math.abs(d[g]);var w=v*(0<d[g]?1:-1),b=(_*d[g]+w+f[g])/this.batch_size,x=this.gsum[l],C=this.xsum[l];if("adagrad"===this.method){x[g]=x[g]+b*b;var S=-this.learning_rate/Math.sqrt(x[g]+this.eps)*b;d[g]+=S}else"windowgrad"===this.method?(x[g]=this.ro*x[g]+(1-this.ro)*b*b,S=-this.learning_rate/Math.sqrt(x[g]+this.eps)*b,d[g]+=S):"adadelta"===this.method?(x[g]=this.ro*x[g]+(1-this.ro)*b*b,S=-Math.sqrt((C[g]+this.eps)/(x[g]+this.eps))*b,C[g]=this.ro*C[g]+(1-this.ro)*S*S,d[g]+=S):0<this.momentum?(S=this.momentum*x[g]-this.learning_rate*b,x[g]=S,d[g]+=S):d[g]+=-this.learning_rate*b;f[g]=0}}return{fwd_time:r,bwd_time:u,l2_decay_loss:s,l1_decay_loss:a,cost_loss:o,softmax_loss:o,loss:o+a+s}}},t.Trainer=e,t.SGDTrainer=e}(n),function(t){"use strict";function e(t,e,i){i=i||{},void 0===t&&(t=[]),void 0===e&&(e=[]),this.data=t,this.labels=e,this.train_ratio=l(i,"train_ratio",.7),this.num_folds=l(i,"num_folds",10),this.num_candidates=l(i,"num_candidates",50),this.num_epochs=l(i,"num_epochs",50),this.ensemble_size=l(i,"ensemble_size",10),this.batch_size_min=l(i,"batch_size_min",10),this.batch_size_max=l(i,"batch_size_max",300),this.l2_decay_min=l(i,"l2_decay_min",-4),this.l2_decay_max=l(i,"l2_decay_max",2),this.learning_rate_min=l(i,"learning_rate_min",-4),this.learning_rate_max=l(i,"learning_rate_max",0),this.momentum_min=l(i,"momentum_min",.9),this.momentum_max=l(i,"momentum_max",.9),this.neurons_min=l(i,"neurons_min",5),this.neurons_max=l(i,"neurons_max",30),this.folds=[],this.candidates=[],this.evaluated_candidates=[],this.unique_labels=c(e),this.iter=0,this.foldix=0,this.finish_fold_callback=null,this.finish_batch_callback=null,0<this.data.length&&(this.sampleFolds(),this.sampleCandidates())}var i=t.randf,r=t.randi,o=t.Net,s=t.Trainer,a=t.maxmin,u=t.randperm,h=t.weightedSample,l=t.getopt,c=t.arrUnique;e.prototype={sampleFolds:function(){var t=this.data.length,e=Math.floor(this.train_ratio*t);this.folds=[];for(var i=0;i<this.num_folds;i++){var n=u(t);this.folds.push({train_ix:n.slice(0,e),test_ix:n.slice(e,t)})}},sampleCandidate:function(){var t=this.data[0].w.length,e=this.unique_labels.length,n=[];n.push({type:"input",out_sx:1,out_sy:1,out_depth:t});for(var a=h([0,1,2,3],[.2,.3,.3,.2]),u=0;u<a;u++){var l=r(this.neurons_min,this.neurons_max),c=["tanh","maxout","relu"][r(0,3)];if(i(0,1)<.5){var d=Math.random();n.push({type:"fc",num_neurons:l,activation:c,drop_prob:d})}else n.push({type:"fc",num_neurons:l,activation:c})}n.push({type:"softmax",num_classes:e});var f=new o;f.makeLayers(n);var p,m=r(this.batch_size_min,this.batch_size_max),_=Math.pow(10,i(this.l2_decay_min,this.l2_decay_max)),v=Math.pow(10,i(this.learning_rate_min,this.learning_rate_max)),y=i(this.momentum_min,this.momentum_max),g=i(0,1),w=new s(f,p=g<.33?{method:"adadelta",batch_size:m,l2_decay:_}:g<.66?{method:"adagrad",learning_rate:v,batch_size:m,l2_decay:_}:{method:"sgd",learning_rate:v,momentum:y,batch_size:m,l2_decay:_}),b={acc:[],accv:0};return b.layer_defs=n,b.trainer_def=p,b.net=f,b.trainer=w,b},sampleCandidates:function(){this.candidates=[];for(var t=0;t<this.num_candidates;t++){var e=this.sampleCandidate();this.candidates.push(e)}},step:function(){this.iter++;for(var t=this.folds[this.foldix],e=t.train_ix[r(0,t.train_ix.length)],i=0;i<this.candidates.length;i++){var n=this.data[e],a=this.labels[e];this.candidates[i].trainer.train(n,a)}var u=this.num_epochs*t.train_ix.length;if(this.iter>=u){var h=this.evalValErrors();for(i=0;i<this.candidates.length;i++)(l=this.candidates[i]).acc.push(h[i]),l.accv+=h[i];if(this.iter=0,this.foldix++,null!==this.finish_fold_callback&&this.finish_fold_callback(),this.foldix>=this.folds.length){for(i=0;i<this.candidates.length;i++)this.evaluated_candidates.push(this.candidates[i]);this.evaluated_candidates.sort((function(t,e){return t.accv/t.acc.length>e.accv/e.acc.length?-1:1})),this.evaluated_candidates.length>3*this.ensemble_size&&(this.evaluated_candidates=this.evaluated_candidates.slice(0,3*this.ensemble_size)),null!==this.finish_batch_callback&&this.finish_batch_callback(),this.sampleCandidates(),this.foldix=0}else for(i=0;i<this.candidates.length;i++){var l=this.candidates[i],c=new o;c.makeLayers(l.layer_defs);var d=new s(c,l.trainer_def);l.net=c,l.trainer=d}}},evalValErrors:function(){for(var t=[],e=this.folds[this.foldix],i=0;i<this.candidates.length;i++){for(var n=this.candidates[i].net,r=0,o=0;o<e.test_ix.length;o++){var s=this.data[e.test_ix[o]],a=this.labels[e.test_ix[o]];n.forward(s),r+=n.getPrediction()===a?1:0}r/=e.test_ix.length,t.push(r)}return t},predict_soft:function(t){var e,i,r=Math.min(this.ensemble_size,this.evaluated_candidates.length);if(0===r)return new n.Vol(0,0,0);for(var o=0;o<r;o++){var s=this.evaluated_candidates[o].net.forward(t);if(0===o)i=(e=s).w.length;else for(var a=0;a<i;a++)e.w[a]+=s.w[a]}for(a=0;a<i;a++)e.w[a]/=i;return e},predict:function(t){var e=this.predict_soft(t);if(0!==e.w.length)var i=a(e.w).maxi;else i=-1;return i},toJSON:function(){for(var t=Math.min(this.ensemble_size,this.evaluated_candidates.length),e={nets:[]},i=0;i<t;i++)e.nets.push(this.evaluated_candidates[i].net.toJSON());return e},fromJSON:function(t){this.ensemble_size=t.nets.length,this.evaluated_candidates=[];for(var e=0;e<this.ensemble_size;e++){var i=new o;i.fromJSON(t.nets[e]);var n={};n.net=i,this.evaluated_candidates.push(n)}},onFinishFold:function(t){this.finish_fold_callback=t},onFinishBatch:function(t){this.finish_batch_callback=t}},t.MagicNet=e}(n),function(e){"use strict";void 0===t.exports?window.jsfeat=e:t.exports=e}(n)},function(t,e,i){var n=i(21),r=i(22),o=i(23);t.exports=function(t){return n(t)||r(t)||o()}},function(t,e){t.exports=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}},function(t,e){var i;i=function(){return this}();try{i=i||new Function("return this")()}catch(t){"object"==typeof window&&(i=window)}t.exports=i},function(t,e){function i(e,n){return t.exports=i=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},i(e,n)}t.exports=i},function(t,e){function i(e){return t.exports=i=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},i(e)}t.exports=i},function(t,e,i){var n,r;function o(){return(o=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t}).apply(this,arguments)}function s(t){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}!function(o){"object"===s(e)&&void 0!==t?t.exports=o():void 0===(r="function"==typeof(n=o)?n.call(e,i,e,t):n)||(t.exports=r)}((function(){"use strict";function t(t,e){var i,n=new t(e);try{i=new CustomEvent("LazyLoad::Initialized",{detail:{instance:n}})}catch(t){(i=document.createEvent("CustomEvent")).initCustomEvent("LazyLoad::Initialized",!1,!1,{instance:n})}window.dispatchEvent(i)}function e(t,e){return t.getAttribute("data-"+e)}function i(t,e,i){var n="data-"+e;null!==i?t.setAttribute(n,i):t.removeAttribute(n)}function n(t){return"true"===e(t,"was-processed")}function r(t,e){return i(t,"ll-timeout",e)}function s(t){return e(t,"ll-timeout")}function a(t,e,i,n){t&&(void 0===n?void 0===i?t(e):t(e,i):t(e,i,n))}function u(t,e){t._loadingCount+=e,0===t._elements.length&&0===t._loadingCount&&a(t._settings.callback_finish,t)}function h(t){for(var e,i=[],n=0;e=t.children[n];n+=1)"SOURCE"===e.tagName&&i.push(e);return i}function l(t,e,i){i&&t.setAttribute(e,i)}function c(t,i){l(t,"sizes",e(t,i.data_sizes)),l(t,"srcset",e(t,i.data_srcset)),l(t,"src",e(t,i.data_src))}function d(t,e){L?t.classList.add(e):t.className+=(t.className?" ":"")+e}function f(t,e){L?t.classList.remove(e):t.className=t.className.replace(new RegExp("(^|\\s+)"+e+"(\\s+|$)")," ").replace(/^\s+/,"").replace(/\s+$/,"")}function p(t,e,i){t.addEventListener(e,i)}function m(t,e,i){t.removeEventListener(e,i)}function _(t,e,i){m(t,"load",e),m(t,"loadeddata",e),m(t,"error",i)}function v(t,e,i){var n=i._settings,r=e?n.class_loaded:n.class_error,o=e?n.callback_loaded:n.callback_error,s=t.target;f(s,n.class_loading),d(s,r),a(o,s,i),u(i,-1)}function y(t,e){var i=e._observer;T(t,e),i&&e._settings.auto_unobserve&&i.unobserve(t)}function g(t){var e=s(t);e&&(clearTimeout(e),r(t,null))}function w(t){return!!E&&(t._observer=new IntersectionObserver((function(e){e.forEach((function(e){return e.isIntersecting||0<e.intersectionRatio?function(t,e,i){var n=i._settings;a(n.callback_enter,t,e,i),(n.load_delay?function(t,e){var i=e._settings.load_delay,n=s(t);n||(n=setTimeout((function(){y(t,e),g(t)}),i),r(t,n))}:y)(t,i)}(e.target,e,t):function(e,i){var n=t._settings;a(n.callback_exit,e,i,t),n.load_delay&&g(e)}(e.target,e)}))}),{root:(e=t._settings).container===document?null:e.container,rootMargin:e.thresholds||e.threshold+"px"}),!0);var e}function b(t,e){return(i=t||function(t){return t.container.querySelectorAll(t.elements_selector)}(e),Array.prototype.slice.call(i)).filter((function(t){return!n(t)}));var i}function x(t,e){var n;this._settings=o({},k,t),this._loadingCount=0,w(this),this.update(e),n=this,C&&window.addEventListener("online",(function(t){!function(t){var e=t._settings;(function(t){return function(t){if(Array.isArray(t)){for(var e=0,i=new Array(t.length);e<t.length;e++)i[e]=t[e];return i}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()})(e.container.querySelectorAll("."+e.class_error)).forEach((function(t){f(t,e.class_error),i(t,"was-processed",null)})),t.update()}(n)}))}var C="undefined"!=typeof window,S=C&&!("onscroll"in window)||"undefined"!=typeof navigator&&/(gle|ing|ro)bot|crawl|spider/i.test(navigator.userAgent),E=C&&"IntersectionObserver"in window,L=C&&"classList"in document.createElement("p"),k={elements_selector:"img",container:S||C?document:null,threshold:300,thresholds:null,data_src:"src",data_srcset:"srcset",data_sizes:"sizes",data_bg:"bg",data_poster:"poster",class_loading:"loading",class_loaded:"loaded",class_error:"error",load_delay:0,auto_unobserve:!0,callback_enter:null,callback_exit:null,callback_reveal:null,callback_loaded:null,callback_error:null,callback_finish:null,use_native:!1},O={IMG:function(t,e){var i=t.parentNode;i&&"PICTURE"===i.tagName&&h(i).forEach((function(t){c(t,e)})),c(t,e)},IFRAME:function(t,i){l(t,"src",e(t,i.data_src))},VIDEO:function(t,i){h(t).forEach((function(t){l(t,"src",e(t,i.data_src))})),l(t,"poster",e(t,i.data_poster)),l(t,"src",e(t,i.data_src)),t.load()}},M=["IMG","IFRAME","VIDEO"],T=function(t,r,o){var s=r._settings;!o&&n(t)||(-1<M.indexOf(t.tagName)&&(function(t,e){function i(r){v(r,!0,e),_(t,i,n)}var n=function n(r){v(r,!1,e),_(t,i,n)};!function(t,e,i){p(t,"load",e),p(t,"loadeddata",e),p(t,"error",i)}(t,i,n)}(t,r),d(t,s.class_loading)),function(t,i){var n,r,o=i._settings,s=t.tagName,a=O[s];if(a)return a(t,o),u(i,1),i._elements=(n=i._elements,r=t,n.filter((function(t){return t!==r})));!function(t,i){var n=e(t,i.data_src),r=e(t,i.data_bg);n&&(t.style.backgroundImage='url("'.concat(n,'")')),r&&(t.style.backgroundImage=r)}(t,o)}(t,r),i(t,"was-processed","true"),a(s.callback_reveal,t,r),a(s.callback_set,t,r))},A=["IMG","IFRAME"];return x.prototype={update:function(t){var e,i=this,n=this._settings;this._elements=b(t,n),!S&&this._observer?(n.use_native&&"loading"in HTMLImageElement.prototype&&((e=this)._elements.forEach((function(t){-1!==A.indexOf(t.tagName)&&(t.setAttribute("loading","lazy"),T(t,e))})),this._elements=b(t,n)),this._elements.forEach((function(t){i._observer.observe(t)}))):this.loadAll()},destroy:function(){var t=this;this._observer&&(this._elements.forEach((function(e){t._observer.unobserve(e)})),this._observer=null),this._elements=null,this._settings=null},load:function(t,e){T(t,this,e)},loadAll:function(){var t=this;this._elements.forEach((function(e){y(e,t)}))}},C&&function(e,i){if(i)if(i.length)for(var n,r=0;n=i[r];r+=1)t(e,n);else t(e,i)}(x,window.lazyLoadOptions),x}))},function(t,e,i){"use strict";var n="bfred-it:object-fit-images",r=/(object-fit|object-position)\s*:\s*([-.\w\s%]+)/g,o="undefined"==typeof Image?{style:{"object-position":1}}:new Image,s="object-fit"in o.style,a="object-position"in o.style,u="background-size"in o.style,h="string"==typeof o.currentSrc,l=o.getAttribute,c=o.setAttribute,d=!1;function f(t,e,i){var n=function(t,e){return"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='"+t+"' height='"+e+"'%3E%3C/svg%3E"}(e||1,i||0);l.call(t,"src")!==n&&c.call(t,"src",n)}function p(t,e){t.naturalWidth?e(t):setTimeout(p,100,t,e)}function m(t){var e=function(t){for(var e,i=getComputedStyle(t).fontFamily,n={};null!==(e=r.exec(i));)n[e[1]]=e[2];return n}(t),i=t[n];if(e["object-fit"]=e["object-fit"]||"fill",!i.img){if("fill"===e["object-fit"])return;if(!i.skipTest&&s&&!e["object-position"])return}if(!i.img){i.img=new Image(t.width,t.height),i.img.srcset=l.call(t,"data-ofi-srcset")||t.srcset,i.img.src=l.call(t,"data-ofi-src")||t.src,c.call(t,"data-ofi-src",t.src),t.srcset&&c.call(t,"data-ofi-srcset",t.srcset),f(t,t.naturalWidth||t.width,t.naturalHeight||t.height),t.srcset&&(t.srcset="");try{!function(t){var e={get:function(e){return t[n].img[e||"src"]},set:function(e,i){return t[n].img[i||"src"]=e,c.call(t,"data-ofi-"+i,e),m(t),e}};Object.defineProperty(t,"src",e),Object.defineProperty(t,"currentSrc",{get:function(){return e.get("currentSrc")}}),Object.defineProperty(t,"srcset",{get:function(){return e.get("srcset")},set:function(t){return e.set(t,"srcset")}})}(t)}catch(e){window.console}}!function(t){if(t.srcset&&!h&&window.picturefill){var e=window.picturefill._;t[e.ns]&&t[e.ns].evaled||e.fillImg(t,{reselect:!0}),t[e.ns].curSrc||(t[e.ns].supported=!1,e.fillImg(t,{reselect:!0})),t.currentSrc=t[e.ns].curSrc||t.src}}(i.img),t.style.backgroundImage='url("'+(i.img.currentSrc||i.img.src).replace(/"/g,'\\"')+'")',t.style.backgroundPosition=e["object-position"]||"center",t.style.backgroundRepeat="no-repeat",t.style.backgroundOrigin="content-box",/scale-down/.test(e["object-fit"])?p(i.img,(function(){i.img.naturalWidth>t.width||i.img.naturalHeight>t.height?t.style.backgroundSize="contain":t.style.backgroundSize="auto"})):t.style.backgroundSize=e["object-fit"].replace("none","auto").replace("fill","100% 100%"),p(i.img,(function(e){f(t,e.naturalWidth,e.naturalHeight)}))}function _(t,e){var i=!d&&!t;if(e=e||{},t=t||"img",a&&!e.skipTest||!u)return!1;"img"===t?t=document.getElementsByTagName("img"):"string"==typeof t?t=document.querySelectorAll(t):"length"in t||(t=[t]);for(var r=0;r<t.length;r++)t[r][n]=t[r][n]||{skipTest:e.skipTest},m(t[r]);i&&(document.body.addEventListener("load",(function(t){"IMG"===t.target.tagName&&_(t.target,{skipTest:e.skipTest})}),!0),d=!0,t="img"),e.watchMQ&&window.addEventListener("resize",_.bind(null,t,{skipTest:e.skipTest}))}_.supportsObjectFit=s,_.supportsObjectPosition=a,function(){function t(t,e){return t[n]&&t[n].img&&("src"===e||"srcset"===e)?t[n].img:t}a||(HTMLImageElement.prototype.getAttribute=function(e){return l.call(t(this,e),e)},HTMLImageElement.prototype.setAttribute=function(e,i){return c.call(t(this,e),e,String(i))})}(),t.exports=_},function(t,e){function i(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}t.exports=function(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}},function(t,e,i){(function(n){var r,o;void 0===(o="function"==typeof(r=function(){"function"!=typeof Promise&&function(e){function i(t,e){return function(){t.apply(e,arguments)}}function r(t){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof t)throw new TypeError("not a function");this._state=null,this._value=null,this._deferreds=[],l(t,i(s,this),i(a,this))}function o(t){var e=this;return null===this._state?void this._deferreds.push(t):void d((function(){var i=e._state?t.onFulfilled:t.onRejected;if(null!==i){var n;try{n=i(e._value)}catch(i){return void t.reject(i)}t.resolve(n)}else(e._state?t.resolve:t.reject)(e._value)}))}function s(t){try{if(t===this)throw new TypeError("A promise cannot be resolved with itself.");if(t&&("object"==typeof t||"function"==typeof t)){var e=t.then;if("function"==typeof e)return void l(i(e,t),i(s,this),i(a,this))}this._state=!0,this._value=t,u.call(this)}catch(t){a.call(this,t)}}function a(t){this._state=!1,this._value=t,u.call(this)}function u(){for(var t=0,e=this._deferreds.length;e>t;t++)o.call(this,this._deferreds[t]);this._deferreds=null}function h(t,e,i,n){this.onFulfilled="function"==typeof t?t:null,this.onRejected="function"==typeof e?e:null,this.resolve=i,this.reject=n}function l(t,e,i){var n=!1;try{t((function(t){n||(n=!0,e(t))}),(function(t){n||(n=!0,i(t))}))}catch(t){if(n)return;n=!0,i(t)}}var c=setTimeout,d="function"==typeof n&&n||function(t){c(t,1)},f=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)};r.prototype.catch=function(t){return this.then(null,t)},r.prototype.then=function(t,e){var i=this;return new r((function(n,r){o.call(i,new h(t,e,n,r))}))},r.all=function(){var t=Array.prototype.slice.call(1===arguments.length&&f(arguments[0])?arguments[0]:arguments);return new r((function(e,i){function n(o,s){try{if(s&&("object"==typeof s||"function"==typeof s)){var a=s.then;if("function"==typeof a)return void a.call(s,(function(t){n(o,t)}),i)}t[o]=s,0==--r&&e(t)}catch(s){i(s)}}if(0===t.length)return e([]);for(var r=t.length,o=0;o<t.length;o++)n(o,t[o])}))},r.resolve=function(t){return t&&"object"==typeof t&&t.constructor===r?t:new r((function(e){e(t)}))},r.reject=function(t){return new r((function(e,i){i(t)}))},r.race=function(t){return new r((function(e,i){for(var n=0,r=t.length;r>n;n++)t[n].then(e,i)}))},r._setImmediateFn=function(t){d=t},t.exports?t.exports=r:e.Promise||(e.Promise=r)}(this),"undefined"!=typeof window&&"function"!=typeof window.CustomEvent&&function(){function t(t,e){e=e||{bubbles:!1,cancelable:!1,detail:void 0};var i=document.createEvent("CustomEvent");return i.initCustomEvent(t,e.bubbles,e.cancelable,e.detail),i}t.prototype=window.Event.prototype,window.CustomEvent=t}(),"undefined"==typeof HTMLCanvasElement||HTMLCanvasElement.prototype.toBlob||Object.defineProperty(HTMLCanvasElement.prototype,"toBlob",{value:function(t,e,i){for(var n=atob(this.toDataURL(e,i).split(",")[1]),r=n.length,o=new Uint8Array(r),s=0;s<r;s++)o[s]=n.charCodeAt(s);t(new Blob([o],{type:e||"image/png"}))}});var e,i,r,o=["Webkit","Moz","ms"],s="undefined"!=typeof document?document.createElement("div").style:{},a=[1,8,3,6],u=[2,7,4,5];function h(t){if(t in s)return t;for(var e=t[0].toUpperCase()+t.slice(1),i=o.length;i--;)if((t=o[i]+e)in s)return t}function l(t,e){for(var i in t=t||{},e)e[i]&&e[i].constructor&&e[i].constructor===Object?(t[i]=t[i]||{},l(t[i],e[i])):t[i]=e[i];return t}function c(t){return l({},t)}function d(t){if("createEvent"in document){var e=document.createEvent("HTMLEvents");e.initEvent("change",!1,!0),t.dispatchEvent(e)}else t.fireEvent("onchange")}function f(t,e,i){if("string"==typeof e){var n=e;(e={})[n]=i}for(var r in e)t.style[r]=e[r]}function p(t,e){t.classList?t.classList.add(e):t.className+=" "+e}function m(t,e){for(var i in e)t.setAttribute(i,e[i])}function _(t){return parseInt(t,10)}function v(t,e){var i=t.naturalWidth,n=t.naturalHeight,r=e||b(t);if(r&&r>=5){var o=i;i=n,n=o}return{width:i,height:n}}i=h("transform"),e=h("transformOrigin"),r=h("userSelect");var y={translate3d:{suffix:", 0px"},translate:{suffix:""}},g=function(t,e,i){this.x=parseFloat(t),this.y=parseFloat(e),this.scale=parseFloat(i)};g.parse=function(t){return t.style?g.parse(t.style[i]):t.indexOf("matrix")>-1||t.indexOf("none")>-1?g.fromMatrix(t):g.fromString(t)},g.fromMatrix=function(t){var e=t.substring(7).split(",");return e.length&&"none"!==t||(e=[1,0,0,1,0,0]),new g(_(e[4]),_(e[5]),parseFloat(e[0]))},g.fromString=function(t){var e=t.split(") "),i=e[0].substring(G.globals.translate.length+1).split(","),n=e.length>1?e[1].substring(6):1,r=i.length>1?i[0]:0,o=i.length>1?i[1]:0;return new g(r,o,n)},g.prototype.toString=function(){var t=y[G.globals.translate].suffix||"";return G.globals.translate+"("+this.x+"px, "+this.y+"px"+t+") scale("+this.scale+")"};var w=function(t){if(!t||!t.style[e])return this.x=0,void(this.y=0);var i=t.style[e].split(" ");this.x=parseFloat(i[0]),this.y=parseFloat(i[1])};function b(t){return t.exifdata&&t.exifdata.Orientation?_(t.exifdata.Orientation):1}function x(t,e,i){var n=e.width,r=e.height,o=t.getContext("2d");switch(t.width=e.width,t.height=e.height,o.save(),i){case 2:o.translate(n,0),o.scale(-1,1);break;case 3:o.translate(n,r),o.rotate(180*Math.PI/180);break;case 4:o.translate(0,r),o.scale(1,-1);break;case 5:t.width=r,t.height=n,o.rotate(90*Math.PI/180),o.scale(1,-1);break;case 6:t.width=r,t.height=n,o.rotate(90*Math.PI/180),o.translate(0,-r);break;case 7:t.width=r,t.height=n,o.rotate(-90*Math.PI/180),o.translate(-n,r),o.scale(1,-1);break;case 8:t.width=r,t.height=n,o.translate(0,n),o.rotate(-90*Math.PI/180)}o.drawImage(e,0,0,n,r),o.restore()}function C(){var t,e,i,n,r,o,s=this,a=s.options.viewport.type?"cr-vp-"+s.options.viewport.type:null;s.options.useCanvas=s.options.enableOrientation||S.call(s),s.data={},s.elements={},t=s.elements.boundary=document.createElement("div"),i=s.elements.viewport=document.createElement("div"),e=s.elements.img=document.createElement("img"),n=s.elements.overlay=document.createElement("div"),s.options.useCanvas?(s.elements.canvas=document.createElement("canvas"),s.elements.preview=s.elements.canvas):s.elements.preview=e,p(t,"cr-boundary"),t.setAttribute("aria-dropeffect","none"),r=s.options.boundary.width,o=s.options.boundary.height,f(t,{width:r+(isNaN(r)?"":"px"),height:o+(isNaN(o)?"":"px")}),p(i,"cr-viewport"),a&&p(i,a),f(i,{width:s.options.viewport.width+"px",height:s.options.viewport.height+"px"}),i.setAttribute("tabindex",0),p(s.elements.preview,"cr-image"),m(s.elements.preview,{alt:"preview","aria-grabbed":"false"}),p(n,"cr-overlay"),s.element.appendChild(t),t.appendChild(s.elements.preview),t.appendChild(i),t.appendChild(n),p(s.element,"croppie-container"),s.options.customClass&&p(s.element,s.options.customClass),A.call(this),s.options.enableZoom&&k.call(s),s.options.enableResize&&E.call(s)}function S(){return this.options.enableExif&&window.EXIF}function E(){var t,e,i,n,o,s,a,u=this,h=document.createElement("div"),l=!1;function c(s){if((void 0===s.button||0===s.button)&&(s.preventDefault(),!l)){var a=u.elements.overlay.getBoundingClientRect();if(l=!0,e=s.pageX,i=s.pageY,t=-1!==s.currentTarget.className.indexOf("vertical")?"v":"h",n=a.width,o=a.height,s.touches){var h=s.touches[0];e=h.pageX,i=h.pageY}window.addEventListener("mousemove",d),window.addEventListener("touchmove",d),window.addEventListener("mouseup",m),window.addEventListener("touchend",m),document.body.style[r]="none"}}function d(r){var s=r.pageX,a=r.pageY;if(r.preventDefault(),r.touches){var l=r.touches[0];s=l.pageX,a=l.pageY}var c=s-e,d=a-i,p=u.options.viewport.height+d,m=u.options.viewport.width+c;"v"===t&&p>=50&&p<=o?(f(h,{height:p+"px"}),u.options.boundary.height+=d,f(u.elements.boundary,{height:u.options.boundary.height+"px"}),u.options.viewport.height+=d,f(u.elements.viewport,{height:u.options.viewport.height+"px"})):"h"===t&&m>=50&&m<=n&&(f(h,{width:m+"px"}),u.options.boundary.width+=c,f(u.elements.boundary,{width:u.options.boundary.width+"px"}),u.options.viewport.width+=c,f(u.elements.viewport,{width:u.options.viewport.width+"px"})),z.call(u),H.call(u),T.call(u),N.call(u),i=a,e=s}function m(){l=!1,window.removeEventListener("mousemove",d),window.removeEventListener("touchmove",d),window.removeEventListener("mouseup",m),window.removeEventListener("touchend",m),document.body.style[r]=""}p(h,"cr-resizer"),f(h,{width:this.options.viewport.width+"px",height:this.options.viewport.height+"px"}),this.options.resizeControls.height&&(p(s=document.createElement("div"),"cr-resizer-vertical"),h.appendChild(s)),this.options.resizeControls.width&&(p(a=document.createElement("div"),"cr-resizer-horisontal"),h.appendChild(a)),s&&(s.addEventListener("mousedown",c),s.addEventListener("touchstart",c)),a&&(a.addEventListener("mousedown",c),a.addEventListener("touchstart",c)),this.elements.boundary.appendChild(h)}function L(t){if(this.options.enableZoom){var e=this.elements.zoomer,i=J(t,4);e.value=Math.max(parseFloat(e.min),Math.min(parseFloat(e.max),i)).toString()}}function k(){var t=this,e=t.elements.zoomerWrap=document.createElement("div"),i=t.elements.zoomer=document.createElement("input");function n(){O.call(t,{value:parseFloat(i.value),origin:new w(t.elements.preview),viewportRect:t.elements.viewport.getBoundingClientRect(),transform:g.parse(t.elements.preview)})}function r(e){var i,r;if("ctrl"===t.options.mouseWheelZoom&&!0!==e.ctrlKey)return 0;i=e.wheelDelta?e.wheelDelta/1200:e.deltaY?e.deltaY/1060:e.detail?e.detail/-60:0,r=t._currentZoom+i*t._currentZoom,e.preventDefault(),L.call(t,r),n.call(t)}p(e,"cr-slider-wrap"),p(i,"cr-slider"),i.type="range",i.step="0.0001",i.value="1",i.style.display=t.options.showZoomer?"":"none",i.setAttribute("aria-label","zoom"),t.element.appendChild(e),e.appendChild(i),t._currentZoom=1,t.elements.zoomer.addEventListener("input",n),t.elements.zoomer.addEventListener("change",n),t.options.mouseWheelZoom&&(t.elements.boundary.addEventListener("mousewheel",r),t.elements.boundary.addEventListener("DOMMouseScroll",r))}function O(t){var n=this,r=t?t.transform:g.parse(n.elements.preview),o=t?t.viewportRect:n.elements.viewport.getBoundingClientRect(),s=t?t.origin:new w(n.elements.preview);function a(){var t={};t[i]=r.toString(),t[e]=s.toString(),f(n.elements.preview,t)}if(n._currentZoom=t?t.value:n._currentZoom,r.scale=n._currentZoom,n.elements.zoomer.setAttribute("aria-valuenow",n._currentZoom),a(),n.options.enforceBoundary){var u=M.call(n,o),h=u.translate,l=u.origin;r.x>=h.maxX&&(s.x=l.minX,r.x=h.maxX),r.x<=h.minX&&(s.x=l.maxX,r.x=h.minX),r.y>=h.maxY&&(s.y=l.minY,r.y=h.maxY),r.y<=h.minY&&(s.y=l.maxY,r.y=h.minY)}a(),I.call(n),N.call(n)}function M(t){var e=this,i=e._currentZoom,n=t.width,r=t.height,o=e.elements.boundary.clientWidth/2,s=e.elements.boundary.clientHeight/2,a=e.elements.preview.getBoundingClientRect(),u=a.width,h=a.height,l=n/2,c=r/2,d=-1*(l/i-o),f=-1*(c/i-s),p=1/i*l,m=1/i*c;return{translate:{maxX:d,minX:d-(u*(1/i)-n*(1/i)),maxY:f,minY:f-(h*(1/i)-r*(1/i))},origin:{maxX:u*(1/i)-p,minX:p,maxY:h*(1/i)-m,minY:m}}}function T(t){var n=this,r=n._currentZoom,o=n.elements.preview.getBoundingClientRect(),s=n.elements.viewport.getBoundingClientRect(),a=g.parse(n.elements.preview.style[i]),u=new w(n.elements.preview),h=s.top-o.top+s.height/2,l=s.left-o.left+s.width/2,c={},d={};if(t){var p=u.x,m=u.y,_=a.x,v=a.y;c.y=p,c.x=m,a.y=_,a.x=v}else c.y=h/r,c.x=l/r,d.y=(c.y-u.y)*(1-r),d.x=(c.x-u.x)*(1-r),a.x-=d.x,a.y-=d.y;var y={};y[e]=c.x+"px "+c.y+"px",y[i]=a.toString(),f(n.elements.preview,y)}function A(){var t,e,n,o,s,a=this,u=!1;function h(t,e){var i=a.elements.preview.getBoundingClientRect(),n=s.y+e,r=s.x+t;a.options.enforceBoundary?(o.top>i.top+e&&o.bottom<i.bottom+e&&(s.y=n),o.left>i.left+t&&o.right<i.right+t&&(s.x=r)):(s.y=n,s.x=r)}function l(t){a.elements.preview.setAttribute("aria-grabbed",t),a.elements.boundary.setAttribute("aria-dropeffect",t?"move":"none")}function c(i){if((void 0===i.button||0===i.button)&&(i.preventDefault(),!u)){if(u=!0,t=i.pageX,e=i.pageY,i.touches){var n=i.touches[0];t=n.pageX,e=n.pageY}l(u),s=g.parse(a.elements.preview),window.addEventListener("mousemove",p),window.addEventListener("touchmove",p),window.addEventListener("mouseup",m),window.addEventListener("touchend",m),document.body.style[r]="none",o=a.elements.viewport.getBoundingClientRect()}}function p(r){r.preventDefault();var o=r.pageX,u=r.pageY;if(r.touches){var l=r.touches[0];o=l.pageX,u=l.pageY}var c=o-t,p=u-e,m={};if("touchmove"===r.type&&r.touches.length>1){var _=r.touches[0],v=r.touches[1],y=Math.sqrt((_.pageX-v.pageX)*(_.pageX-v.pageX)+(_.pageY-v.pageY)*(_.pageY-v.pageY));n||(n=y/a._currentZoom);var g=y/n;return L.call(a,g),void d(a.elements.zoomer)}h(c,p),m[i]=s.toString(),f(a.elements.preview,m),z.call(a),e=u,t=o}function m(){l(u=!1),window.removeEventListener("mousemove",p),window.removeEventListener("touchmove",p),window.removeEventListener("mouseup",m),window.removeEventListener("touchend",m),document.body.style[r]="",T.call(a),N.call(a),n=0}a.elements.overlay.addEventListener("mousedown",c),a.elements.viewport.addEventListener("keydown",(function(t){var e;if(!t.shiftKey||38!==t.keyCode&&40!==t.keyCode){if(a.options.enableKeyMovement&&t.keyCode>=37&&t.keyCode<=40){t.preventDefault();var u=function(t){switch(t){case 37:return[1,0];case 38:return[0,1];case 39:return[-1,0];case 40:return[0,-1]}}(t.keyCode);s=g.parse(a.elements.preview),document.body.style[r]="none",o=a.elements.viewport.getBoundingClientRect(),function(t){var e=t[0],o=t[1],u={};h(e,o),u[i]=s.toString(),f(a.elements.preview,u),z.call(a),document.body.style[r]="",T.call(a),N.call(a),n=0}(u)}}else e=38===t.keyCode?parseFloat(a.elements.zoomer.value)+parseFloat(a.elements.zoomer.step):parseFloat(a.elements.zoomer.value)-parseFloat(a.elements.zoomer.step),a.setZoom(e)})),a.elements.overlay.addEventListener("touchstart",c)}function z(){if(this.elements){var t=this,e=t.elements.boundary.getBoundingClientRect(),i=t.elements.preview.getBoundingClientRect();f(t.elements.overlay,{width:i.width+"px",height:i.height+"px",top:i.top-e.top+"px",left:i.left-e.left+"px"})}}w.prototype.toString=function(){return this.x+"px "+this.y+"px"};var I=function(t,e,i){var n;return function(){var r=this,o=arguments,s=function(){n=null,i||t.apply(r,o)},a=i&&!n;clearTimeout(n),n=setTimeout(s,e),a&&t.apply(r,o)}}(z,500);function N(){var t,e=this,i=e.get();j.call(e)&&(e.options.update.call(e,i),e.$&&"undefined"==typeof Prototype?e.$(e.element).trigger("update.croppie",i):(window.CustomEvent?t=new CustomEvent("update",{detail:i}):(t=document.createEvent("CustomEvent")).initCustomEvent("update",!0,!0,i),e.element.dispatchEvent(t)))}function j(){return this.elements.preview.offsetHeight>0&&this.elements.preview.offsetWidth>0}function R(){var t,n=this,r={},o=n.elements.preview,s=new g(0,0,1),a=new w;j.call(n)&&!n.data.bound&&(n.data.bound=!0,r[i]=s.toString(),r[e]=a.toString(),r.opacity=1,f(o,r),t=n.elements.preview.getBoundingClientRect(),n._originalImageWidth=t.width,n._originalImageHeight=t.height,n.data.orientation=S.call(n)?b(n.elements.img):n.data.orientation,n.options.enableZoom?H.call(n,!0):n._currentZoom=1,s.scale=n._currentZoom,r[i]=s.toString(),f(o,r),n.data.points.length?P.call(n,n.data.points):W.call(n),T.call(n),z.call(n))}function H(t){var e,i,n,r,o=this,s=Math.max(o.options.minZoom,0)||0,a=o.options.maxZoom||1.5,u=o.elements.zoomer,h=parseFloat(u.value),l=o.elements.boundary.getBoundingClientRect(),c=v(o.elements.img,o.data.orientation),f=o.elements.viewport.getBoundingClientRect();o.options.enforceBoundary&&(n=f.width/c.width,r=f.height/c.height,s=Math.max(n,r)),s>=a&&(a=s+1),u.min=J(s,4),u.max=J(a,4),!t&&(h<u.min||h>u.max)?L.call(o,h<u.min?u.min:u.max):t&&(i=Math.max(l.width/c.width,l.height/c.height),e=null!==o.data.boundZoom?o.data.boundZoom:i,L.call(o,e)),d(u)}function P(t){if(4!==t.length)throw"Croppie - Invalid number of points supplied: "+t;var n=this,r=t[2]-t[0],o=n.elements.viewport.getBoundingClientRect(),s=n.elements.boundary.getBoundingClientRect(),a=o.left-s.left,u=o.top-s.top,h=o.width/r,l=t[1],c=t[0],d=-1*t[1]+u,p=-1*t[0]+a,m={};m[e]=c+"px "+l+"px",m[i]=new g(p,d,h).toString(),f(n.elements.preview,m),L.call(n,h),n._currentZoom=h}function W(){var t=this,e=t.elements.preview.getBoundingClientRect(),n=t.elements.viewport.getBoundingClientRect(),r=t.elements.boundary.getBoundingClientRect(),o=n.left-r.left,s=n.top-r.top,a=o-(e.width-n.width)/2,u=s-(e.height-n.height)/2,h=new g(a,u,t._currentZoom);f(t.elements.preview,i,h.toString())}function F(t){var e=this,i=e.elements.canvas,n=e.elements.img;i.getContext("2d").clearRect(0,0,i.width,i.height),i.width=n.width,i.height=n.height,x(i,n,e.options.enableOrientation&&t||b(n))}function q(t){var e=this,i=t.points,n=_(i[0]),r=_(i[1]),o=_(i[2])-n,s=_(i[3])-r,a=t.circle,u=document.createElement("canvas"),h=u.getContext("2d"),l=t.outputWidth||o,c=t.outputHeight||s;u.width=l,u.height=c,t.backgroundColor&&(h.fillStyle=t.backgroundColor,h.fillRect(0,0,l,c));var d=n,f=r,p=o,m=s,v=0,y=0,g=l,w=c;return n<0&&(d=0,v=Math.abs(n)/o*l),p+d>e._originalImageWidth&&(g=(p=e._originalImageWidth-d)/o*l),r<0&&(f=0,y=Math.abs(r)/s*c),m+f>e._originalImageHeight&&(w=(m=e._originalImageHeight-f)/s*c),h.drawImage(this.elements.preview,d,f,p,m,v,y,g,w),a&&(h.fillStyle="#fff",h.globalCompositeOperation="destination-in",h.beginPath(),h.arc(u.width/2,u.height/2,u.width/2,0,2*Math.PI,!0),h.closePath(),h.fill()),u}function B(t){this.elements.img.parentNode&&(Array.prototype.forEach.call(this.elements.img.classList,(function(e){t.classList.add(e)})),this.elements.img.parentNode.replaceChild(t,this.elements.img),this.elements.preview=t),this.elements.img=t}function D(t,e){var i,n=this,r=[],o=null,s=S.call(n);if("string"==typeof t)i=t,t={};else if(Array.isArray(t))r=t.slice();else{if(void 0===t&&n.data.url)return R.call(n),N.call(n),null;i=t.url,r=t.points||[],o=void 0===t.zoom?null:t.zoom}return n.data.bound=!1,n.data.url=i||n.data.url,n.data.boundZoom=o,function(t,e){if(!t)throw"Source image missing";var i=new Image;return i.style.opacity="0",new Promise((function(n,r){function o(){i.style.opacity="1",setTimeout((function(){n(i)}),1)}i.removeAttribute("crossOrigin"),t.match(/^https?:\/\/|^\/\//)&&i.setAttribute("crossOrigin","anonymous"),i.onload=function(){e?EXIF.getData(i,(function(){o()})):o()},i.onerror=function(t){i.style.opacity=1,setTimeout((function(){r(t)}),1)},i.src=t}))}(i,s).then((function(i){if(B.call(n,i),r.length)n.options.relative&&(r=[r[0]*i.naturalWidth/100,r[1]*i.naturalHeight/100,r[2]*i.naturalWidth/100,r[3]*i.naturalHeight/100]);else{var o,s,a=v(i),u=n.elements.viewport.getBoundingClientRect(),h=u.width/u.height;a.width/a.height>h?o=(s=a.height)*h:(o=a.width,s=a.height/h);var l=(a.width-o)/2,c=(a.height-s)/2,d=l+o,f=c+s;n.data.points=[l,c,d,f]}n.data.orientation=t.orientation||1,n.data.points=r.map((function(t){return parseFloat(t)})),n.options.useCanvas&&F.call(n,n.data.orientation),R.call(n),N.call(n),e&&e()}))}function J(t,e){return parseFloat(t).toFixed(e||0)}function Z(){var t=this,e=t.elements.preview.getBoundingClientRect(),i=t.elements.viewport.getBoundingClientRect(),n=i.left-e.left,r=i.top-e.top,o=(i.width-t.elements.viewport.offsetWidth)/2,s=(i.height-t.elements.viewport.offsetHeight)/2,a=n+t.elements.viewport.offsetWidth+o,u=r+t.elements.viewport.offsetHeight+s,h=t._currentZoom;(h===1/0||isNaN(h))&&(h=1);var l=t.options.enforceBoundary?0:Number.NEGATIVE_INFINITY;return n=Math.max(l,n/h),r=Math.max(l,r/h),a=Math.max(l,a/h),u=Math.max(l,u/h),{points:[J(n),J(r),J(a),J(u)],zoom:h,orientation:t.data.orientation}}var X={type:"canvas",format:"png",quality:1},V=["jpeg","webp","png"];if("undefined"!=typeof window&&window.jQuery){var Y=window.jQuery;Y.fn.croppie=function(t){var e=typeof t;if("string"===e){var i=Array.prototype.slice.call(arguments,1),n=Y(this).data("croppie");return"get"===t?n.get():"result"===t?n.result.apply(n,i):"bind"===t?n.bind.apply(n,i):this.each((function(){var e=Y(this).data("croppie");if(e){var n=e[t];if(!Y.isFunction(n))throw"Croppie "+t+" method not found";n.apply(e,i),"destroy"===t&&Y(this).removeData("croppie")}}))}return this.each((function(){var e=new G(this,t);e.$=Y,Y(this).data("croppie",e)}))}}function G(t,e){if(t.className.indexOf("croppie-container")>-1)throw new Error("Croppie: Can't initialize croppie more than once");if(this.element=t,this.options=l(c(G.defaults),e),"img"===this.element.tagName.toLowerCase()){var i=this.element;p(i,"cr-original-image"),m(i,{"aria-hidden":"true",alt:""});var n=document.createElement("div");this.element.parentNode.appendChild(n),n.appendChild(i),this.element=n,this.options.url=this.options.url||i.src}if(C.call(this),this.options.url){var r={url:this.options.url,points:this.options.points};delete this.options.url,delete this.options.points,D.call(this,r)}}return G.defaults={viewport:{width:100,height:100,type:"square"},boundary:{},orientationControls:{enabled:!0,leftClass:"",rightClass:""},resizeControls:{width:!0,height:!0},customClass:"",showZoomer:!0,enableZoom:!0,enableResize:!1,mouseWheelZoom:!0,enableExif:!1,enforceBoundary:!0,enableOrientation:!1,enableKeyMovement:!0,update:function(){}},G.globals={translate:"translate3d"},l(G.prototype,{bind:function(t,e){return D.call(this,t,e)},get:function(){var t=Z.call(this),e=t.points;return this.options.relative&&(e[0]/=this.elements.img.naturalWidth/100,e[1]/=this.elements.img.naturalHeight/100,e[2]/=this.elements.img.naturalWidth/100,e[3]/=this.elements.img.naturalHeight/100),t},result:function(t){return function(t){var e=this,i=Z.call(e),n=l(c(X),c(t)),r="string"==typeof t?t:n.type||"base64",o=n.size||"viewport",s=n.format,a=n.quality,u=n.backgroundColor,h="boolean"==typeof n.circle?n.circle:"circle"===e.options.viewport.type,d=e.elements.viewport.getBoundingClientRect(),m=d.width/d.height;return"viewport"===o?(i.outputWidth=d.width,i.outputHeight=d.height):"object"==typeof o&&(o.width&&o.height?(i.outputWidth=o.width,i.outputHeight=o.height):o.width?(i.outputWidth=o.width,i.outputHeight=o.width/m):o.height&&(i.outputWidth=o.height*m,i.outputHeight=o.height)),-1<V.indexOf(s)&&(i.format="image/"+s,i.quality=a),i.circle=h,i.url=e.data.url,i.backgroundColor=u,new Promise((function(t){switch(r.toLowerCase()){case"rawcanvas":t(q.call(e,i));break;case"canvas":case"base64":t(function(t){return q.call(this,t).toDataURL(t.format,t.quality)}.call(e,i));break;case"blob":(function(t){var e=this;return new Promise((function(i){q.call(e,t).toBlob((function(t){i(t)}),t.format,t.quality)}))}).call(e,i).then(t);break;default:t(function(t){var e=t.points,i=document.createElement("div"),n=document.createElement("img"),r=e[2]-e[0],o=e[3]-e[1];return p(i,"croppie-result"),i.appendChild(n),f(n,{left:-1*e[0]+"px",top:-1*e[1]+"px"}),n.src=t.url,f(i,{width:r+"px",height:o+"px"}),i}.call(e,i))}}))}.call(this,t)},refresh:function(){return function(){R.call(this)}.call(this)},setZoom:function(t){L.call(this,t),d(this.elements.zoomer)},rotate:function(t){(function(t){if(!this.options.useCanvas||!this.options.enableOrientation)throw"Croppie: Cannot rotate without enableOrientation && EXIF.js included";var e=this,i=e.elements.canvas;if(e.data.orientation=function(t,e){var i=-1<a.indexOf(t)?a:u,n=i.indexOf(t),r=e/90%i.length;return i[(i.length+n+r%i.length)%i.length]}(e.data.orientation,t),x(i,e.elements.img,e.data.orientation),T.call(e,!0),H.call(e),Math.abs(t)/90%2==1){var n=e._originalImageHeight,r=e._originalImageWidth;e._originalImageWidth=n,e._originalImageHeight=r}}).call(this,t)},destroy:function(){return function(){var t=this;t.element.removeChild(t.elements.boundary),function(t,e){t.classList?t.classList.remove(e):t.className=t.className.replace(e,"")}(t.element,"croppie-container"),t.options.enableZoom&&t.element.removeChild(t.elements.zoomerWrap),delete t.elements}.call(this)}}),G})?r.call(e,i,e,t):r)||(t.exports=o)}).call(this,i(18).setImmediate)},function(t,e,i){var n=i(24),r=i(25);t.exports=function(t,e){return!e||"object"!==n(e)&&"function"!=typeof e?r(t):e}},function(t,e,i){var n=i(5);t.exports=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&n(t,e)}},function(t,e,i){var n=i(6),r=i(5),o=i(26),s=i(27);function a(e){var i="function"==typeof Map?new Map:void 0;return t.exports=a=function(t){if(null===t||!o(t))return t;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==i){if(i.has(t))return i.get(t);i.set(t,e)}function e(){return s(t,arguments,n(this).constructor)}return e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),r(e,t)},a(e)}t.exports=a},function(t,e,i){(function(e){var i=e.CustomEvent;t.exports=function(){try{var t=new i("cat",{detail:{foo:"bar"}});return"cat"===t.type&&"bar"===t.detail.foo}catch(t){}}()?i:"undefined"!=typeof document&&"function"==typeof document.createEvent?function(t,e){var i=document.createEvent("CustomEvent");return e?i.initCustomEvent(t,e.bubbles,e.cancelable,e.detail):i.initCustomEvent(t,!1,!1,void 0),i}:function(t,e){var i=document.createEventObject();return i.type=t,e?(i.bubbles=Boolean(e.bubbles),i.cancelable=Boolean(e.cancelable),i.detail=e.detail):(i.bubbles=!1,i.cancelable=!1,i.detail=void 0),i}}).call(this,i(4))},function(t,e){t.exports=function(){function t(t){return"function"==typeof t}function e(t){var e=function(t){var e=Number(t);return isNaN(e)?0:0!==e&&isFinite(e)?(0<e?1:-1)*Math.floor(Math.abs(e)):e}(t);return Math.min(Math.max(e,0),n)}function i(t){var e=t.next();return!Boolean(e.done)&&e}var n=Math.pow(2,53)-1;return function(n,r,o){"use strict";var s,a,u,h=1<arguments.length?r:void 0;if(void 0!==h){if(!t(h))throw new TypeError("Array.from: when provided, the second argument must be a function");2<arguments.length&&(s=o)}var l=function(e,i){if(null!=e&&null!=i){var n=e[i];if(null==n)return;if(!t(n))throw new TypeError(n+" is not a function");return n}}(n,function(t){if(null!=t){if(-1<["string","number","boolean","symbol"].indexOf(typeof t))return Symbol.iterator;if("undefined"!=typeof Symbol&&"iterator"in Symbol&&Symbol.iterator in t)return Symbol.iterator;if("@@iterator"in t)return"@@iterator"}}(n));if(void 0!==l){a=t(this)?Object(new this):[];var c,d,f=l.call(n);if(null==f)throw new TypeError("Array.from requires an array-like or iterable object");for(u=0;;){if(!(c=i(f)))return a.length=u,a;d=c.value,a[u]=h?h.call(s,d,u):d,u++}}else{var p=Object(n);if(null==n)throw new TypeError("Array.from requires an array-like object - not null or undefined");var m,_=e(p.length);for(a=t(this)?Object(new this(_)):new Array(_),u=0;u<_;)m=p[u],a[u]=h?h.call(s,m,u):m,u++;a.length=_}return a}}()},function(t,e,i){"use strict";i(17).polyfill()},function(t,e,i){"use strict";function n(t,e){if(null==t)throw new TypeError("Cannot convert first argument to object");for(var i=Object(t),n=1;n<arguments.length;n++){var r=arguments[n];if(null!=r)for(var o=Object.keys(Object(r)),s=0,a=o.length;s<a;s++){var u=o[s],h=Object.getOwnPropertyDescriptor(r,u);void 0!==h&&h.enumerable&&(i[u]=r[u])}}return i}t.exports={assign:n,polyfill:function(){Object.assign||Object.defineProperty(Object,"assign",{enumerable:!1,configurable:!0,writable:!0,value:n})}}},function(t,e,i){(function(t){var n=void 0!==t&&t||"undefined"!=typeof self&&self||window,r=Function.prototype.apply;function o(t,e){this._id=t,this._clearFn=e}e.setTimeout=function(){return new o(r.call(setTimeout,n,arguments),clearTimeout)},e.setInterval=function(){return new o(r.call(setInterval,n,arguments),clearInterval)},e.clearTimeout=e.clearInterval=function(t){t&&t.close()},o.prototype.unref=o.prototype.ref=function(){},o.prototype.close=function(){this._clearFn.call(n,this._id)},e.enroll=function(t,e){clearTimeout(t._idleTimeoutId),t._idleTimeout=e},e.unenroll=function(t){clearTimeout(t._idleTimeoutId),t._idleTimeout=-1},e._unrefActive=e.active=function(t){clearTimeout(t._idleTimeoutId);var e=t._idleTimeout;0<=e&&(t._idleTimeoutId=setTimeout((function(){t._onTimeout&&t._onTimeout()}),e))},i(19),e.setImmediate="undefined"!=typeof self&&self.setImmediate||void 0!==t&&t.setImmediate||this&&this.setImmediate,e.clearImmediate="undefined"!=typeof self&&self.clearImmediate||void 0!==t&&t.clearImmediate||this&&this.clearImmediate}).call(this,i(4))},function(t,e,i){(function(t,e){!function(t,i){"use strict";if(!t.setImmediate){var n,r=1,o={},s=!1,a=t.document,u=Object.getPrototypeOf&&Object.getPrototypeOf(t);u=u&&u.setTimeout?u:t,("[object process]"==={}.toString.call(t.process)?function(){n=function(t){e.nextTick((function(){l(t)}))}}:function(){if(t.postMessage&&!t.importScripts){var e=!0,i=t.onmessage;return t.onmessage=function(){e=!1},t.postMessage("","*"),t.onmessage=i,e}}()?function(){function e(e){e.source===t&&"string"==typeof e.data&&0===e.data.indexOf(i)&&l(+e.data.slice(i.length))}var i="setImmediate$"+Math.random()+"$";t.addEventListener?t.addEventListener("message",e,!1):t.attachEvent("onmessage",e),n=function(e){t.postMessage(i+e,"*")}}:t.MessageChannel?function(){var t=new MessageChannel;t.port1.onmessage=function(t){l(t.data)},n=function(e){t.port2.postMessage(e)}}:a&&"onreadystatechange"in a.createElement("script")?function(){var t=a.documentElement;n=function(e){var i=a.createElement("script");i.onreadystatechange=function(){l(e),i.onreadystatechange=null,t.removeChild(i),i=null},t.appendChild(i)}}:function(){n=function(t){setTimeout(l,0,t)}})(),u.setImmediate=function(t){"function"!=typeof t&&(t=new Function(""+t));for(var e=new Array(arguments.length-1),i=0;i<e.length;i++)e[i]=arguments[i+1];var s={callback:t,args:e};return o[r]=s,n(r),r++},u.clearImmediate=h}function h(t){delete o[t]}function l(t){if(s)setTimeout(l,0,t);else{var e=o[t];if(e){s=!0;try{!function(t){var e=t.callback,i=t.args;switch(i.length){case 0:e();break;case 1:e(i[0]);break;case 2:e(i[0],i[1]);break;case 3:e(i[0],i[1],i[2]);break;default:e.apply(void 0,i)}}(e)}finally{h(t),s=!1}}}}}("undefined"==typeof self?void 0===t?this:t:self)}).call(this,i(4),i(20))},function(t,e){var i,n,r=t.exports={};function o(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function a(t){if(i===setTimeout)return setTimeout(t,0);if((i===o||!i)&&setTimeout)return i=setTimeout,setTimeout(t,0);try{return i(t,0)}catch(e){try{return i.call(null,t,0)}catch(e){return i.call(this,t,0)}}}!function(){try{i="function"==typeof setTimeout?setTimeout:o}catch(t){i=o}try{n="function"==typeof clearTimeout?clearTimeout:s}catch(t){n=s}}();var u,h=[],l=!1,c=-1;function d(){l&&u&&(l=!1,u.length?h=u.concat(h):c=-1,h.length&&f())}function f(){if(!l){var t=a(d);l=!0;for(var e=h.length;e;){for(u=h,h=[];++c<e;)u&&u[c].run();c=-1,e=h.length}u=null,l=!1,function(t){if(n===clearTimeout)return clearTimeout(t);if((n===s||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(t);try{n(t)}catch(e){try{return n.call(null,t)}catch(e){return n.call(this,t)}}}(t)}}function p(t,e){this.fun=t,this.array=e}function m(){}r.nextTick=function(t){var e=new Array(arguments.length-1);if(1<arguments.length)for(var i=1;i<arguments.length;i++)e[i-1]=arguments[i];h.push(new p(t,e)),1!==h.length||l||a(f)},p.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=m,r.addListener=m,r.once=m,r.off=m,r.removeListener=m,r.removeAllListeners=m,r.emit=m,r.prependListener=m,r.prependOnceListener=m,r.listeners=function(t){return[]},r.binding=function(t){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(t){throw new Error("process.chdir is not supported")},r.umask=function(){return 0}},function(t,e){t.exports=function(t){if(Array.isArray(t)){for(var e=0,i=new Array(t.length);e<t.length;e++)i[e]=t[e];return i}}},function(t,e){t.exports=function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}},function(t,e){t.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}},function(t,e){function i(e){return"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?t.exports=i=function(t){return typeof t}:t.exports=i=function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},i(e)}t.exports=i},function(t,e){t.exports=function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}},function(t,e){t.exports=function(t){return-1!==Function.toString.call(t).indexOf("[native code]")}},function(t,e,i){var n=i(5);function r(e,i,o){return function(){if("undefined"!=typeof Reflect&&Reflect.construct&&!Reflect.construct.sham){if("function"==typeof Proxy)return 1;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),1}catch(t){return}}}()?t.exports=r=Reflect.construct:t.exports=r=function(t,e,i){var r=[null];r.push.apply(r,e);var o=new(Function.bind.apply(t,r));return i&&n(o,i.prototype),o},r.apply(null,arguments)}t.exports=r},,function(t,e,i){"use strict";i.r(e);var n=i(0),r=i.n(n),o=i(7),s=i.n(o),a=(i(16),i(8)),u=i.n(a),h=i(3),l=i.n(h),c=i(9),d=i.n(c),f=i(1),p=i.n(f),m=i(10),_=i.n(m),v=(i(2),i(11)),y=(i.n(v),i(6)),g=(i.n(y),i(12)),w=(i.n(g),i(13)),b=i.n(w),x=i(14),C=i.n(x);function S(t,e){if(t)if(NodeList.prototype.isPrototypeOf(t)||Array.prototype.isPrototypeOf(t))r()(t).forEach((function(t){return S(t,e)}));else{var i=(t.getAttribute("class")||"").split(" ").filter(Boolean).filter((function(t){return t!==e}));t.setAttribute("class",i.join(" "))}}HTMLElement.prototype.getCompatibleBoundingClientRect=function(){var t=HTMLElement.prototype.getBoundingClientRect;return function(){try{return t.apply(this)}catch(t){return{left:"",right:"",top:"",bottom:""}}}}(),b()(Error);var E=function(){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};l()(this,t),this.element=e.element,this.cropWrapper=this.element.querySelector(".mod--script-container__image-crop__wrapper"),this.uploadWrapper=this.element.querySelector(".mod--script-container__upload__wrapper"),this.upload=this.element.querySelector("#mod--script-container__upload__input"),this.startTickButton=this.element.querySelector(".mod--script-container__canvas--image__start-tick"),this.colorSelectWrapper=this.element.querySelector(".mod--script-container__color-select__wrapper"),this.colorAddButton=this.element.querySelector(".color-add"),this.colorOverviewWrapper=this.element.querySelector(".mod--script-container__color-overview__wrapper"),this.reportDiv=this.element.querySelector(".mod--script-container__report"),this.imageCanvas=this.element.querySelector("#canvas--image"),this.netCanvas=this.element.querySelector("#canvas--net"),this.colorCanvas=this.element.querySelector("#canvas--color"),this.outlineCanvas=this.element.querySelector("#canvas--outline"),this.finalCanvas=this.element.querySelector("#canvas--final"),this.downloadsWrapper=this.element.querySelector(".mod--script-container__downloads"),this.polygonArray=[],this.json=this.element.querySelector("#colors-json").innerHTML,this.defaultWidth=800,this.defaultHeight=null,this.batchesPerIteration=100,this.smoothLoss=-1,this.drawingCount=100,this.maxIterations=2e3,this.colorArray=[],this.tickedBefore=!1}return d()(t,[{key:"init",value:function(){this.initUpload(),this.initEvents(),this.addColorFunctions()}},{key:"initEvents",value:function(){var t=this;window.addEventListener("color-swatch-added",(function(e){t.updateColors()}))}},{key:"updateColors",value:function(){var t=this;S(this.colorOverviewWrapper,"hidden"),this.colorOverviewWrapper.innerHTML="",this.colorArray.forEach((function(e){var i='\n        <div class="swatch-item">\n          <div class="swatch-item__swatch" style="background: rgb('.concat(e.r,", ").concat(e.g,", ").concat(e.b,');"></div>\n          <div class="swatch-item__name">').concat(e.name,"</div>\n        </div>\n      ");t.colorOverviewWrapper.innerHTML+=i})),1<this.colorArray.length&&S(this.uploadWrapper,"hidden")}},{key:"addColorFunctions",value:function(){var t=this;this.brands=JSON.parse(this.json).brands,this.colorAddButton.addEventListener("click",(function(){var e=r()(t.colorSelectWrapper.querySelectorAll(".color-select__holder")).length,i='\n        <div class="color-select__holder" data-index="'.concat(e,'">\n          <div class="color-select__index"><span>').concat(e+1,'</span></div>\n          <div class="color-select__brand"></div>\n          <div class="color-select__color"></div>\n          <div class="color-select__amount"></div>\n          <div class="color-select__append"></div>\n        </div>\n      ');t.colorSelectWrapper.insertAdjacentHTML("beforeend",i);var n="<select>";n+='\n        <option value="" disabled selected>Marke wählen</option>\n      ',t.brands.forEach((function(t){var e='<option value="'.concat(t.brand,'">').concat(t.brand,"</option>");n+=e})),n+="</select>";var o=t.colorSelectWrapper.querySelector('[data-index="'.concat(e,'"]')),s=o.querySelector(".color-select__brand");s.innerHTML="",s.innerHTML+=n,s.addEventListener("change",(function(i){var n="<select>";n+='\n          <option value="" disabled selected>Farbe wählen</option>\n        ';var r=t.brands.find((function(t){return t.brand===i.target.value}));r.colors.forEach((function(t){var e='<option value="'.concat(t.title,'">').concat(t.title,"</option>");n+=e})),n+="</select>";var s=o.querySelector(".color-select__color");s.innerHTML="",s.innerHTML+=n,s.querySelector("select").addEventListener("change",(function(i){var n=i.target.value,s=document.createElement("input");s.type="text",o.querySelector(".color-select__amount").innerHTML="",o.querySelector(".color-select__amount").appendChild(s);var a=document.createElement("button");a.innerHTML="Farbe Hinzufügen",o.querySelector(".color-select__append").innerHTML="",o.querySelector(".color-select__append").appendChild(a),a.addEventListener("click",(function(){var i=r.colors.find((function(t){return t.title===n}));t.colorArray.push({title:i.title,name:e+1,r:"HEX"===i.color.type?t.hexToRgb(i.color.value).r:i.color.r,g:"HEX"===i.color.type?t.hexToRgb(i.color.value).g:i.color.g,b:"HEX"===i.color.type?t.hexToRgb(i.color.value).b:i.color.b,amount:Number(s.value)||100}),function(t,e){var i=new C.a("color-swatch-added",{detail:{}});window.dispatchEvent(i)}()}))}))}))})),this.initUpload()}},{key:"initUpload",value:function(){var t=this;this.upload.onchange=function(e){Promise.resolve().then((function(){return t.initFileReader(e.target.files[0])}))}}},{key:"initFileReader",value:function(t){var e=this;return new Promise((function(i,n){var r=new FileReader;r.onload=function(){e.originalFile=r.result,e.addCrop()},r.readAsDataURL(t)}))}},{key:"addCrop",value:function(){var t=this,e=new Image;e.src=this.originalFile,e.onload=function(){S(t.cropWrapper,"hidden"),t.cropWrapper.querySelector(".mod--script-container__image-crop__holder").appendChild(e);var i=new _.a(e,{enableResize:!0,viewport:{width:800,height:300}});t.cropWrapper.querySelector(".crop-button").addEventListener("click",(function(e){var n=Number(i.get().points[2])-Number(i.get().points[0]),r=Number(i.get().points[3])-Number(i.get().points[1]);t.ratio=t.defaultWidth/n,t.defaultHeight=r*t.ratio,i.result("base64").then((function(e){t.file=e,t.placeResult()}))}))}}},{key:"placeResult",value:function(){var t=this;this.originalImage=new Image,this.originalImage.src=this.file,this.originalImage.onload=function(){t.imageCanvas.width=t.defaultWidth,t.imageCanvas.height=t.defaultHeight,t.netCanvas.width=t.defaultWidth,t.netCanvas.height=t.defaultHeight,t.imageContext=t.imageCanvas.getContext("2d"),t.netContext=t.netCanvas.getContext("2d"),t.imageContext.drawImage(t.originalImage,0,0,t.defaultWidth,t.defaultHeight),t.originalData=t.imageContext.getImageData(0,0,t.defaultWidth,t.defaultHeight),S(t.startTickButton,"hidden"),t.startTickButton.addEventListener("click",(function(){t.tickedBefore||(t.startTick(),t.tickedBefore)}))}}},{key:"startTick",value:function(){var t=this;this.reload(),this.interval=setInterval((function(){t.tick()}),1)}},{key:"reload",value:function(){this.counter=0;var t=[];t.push({type:"input",out_sx:1,out_sy:1,out_depth:2});for(var e=0;e<5;e+=1)t.push({type:"fc",num_neurons:20,activation:"relu"});t.push({type:"regression",num_neurons:3}),this.net=new p.a.Net,this.net.makeLayers(t),this.trainer=new p.a.SGDTrainer(this.net,{learning_rate:.01,momentum:.9,batch_size:5,l2_decay:0})}},{key:"tick",value:function(){this.update(),this.draw(),this.counter+=1}},{key:"update",value:function(){this.defaultHeight=this.netCanvas.height;for(var t=this.originalData.data,e=new p.a.Vol(1,1,2),i=0,n=0,r=0;r<this.trainer.batch_size;r+=1)for(var o=0;o<this.batchesPerIteration;o+=1){var s=p.a.randi(0,this.defaultWidth),a=p.a.randi(0,this.defaultHeight),u=4*(this.defaultWidth*a+s),h=[t[u]/255,t[1+u]/255,t[2+u]/255];e.w[0]=(s-this.defaultWidth/2)/this.defaultWidth,e.w[1]=(a-this.defaultHeight/2)/this.defaultHeight,i+=this.trainer.train(e,h).loss,n+=1}i/=n,0===this.counter?this.smoothLoss=i:this.smoothLoss=.99*this.smoothLoss+.01*i;var l="Net Loss: ".concat(this.smoothLoss,"<br/>Net Iteration: ").concat(this.counter);this.reportDiv.innerHTML=l,S(this.reportDiv,"hidden")}},{key:"draw",value:function(){if(this.counter%this.drawingCount==0){if(this.counter>=this.maxIterations)return clearInterval(this.interval),void this.filter();for(var t=this.netCanvas.width,e=this.netCanvas.height,i=this.netContext.getImageData(0,0,t,e),n=new p.a.Vol(1,1,2),r=0;r<t;r+=1){n.w[0]=(r-t/2)/t;for(var o=0;o<e;o+=1){n.w[1]=(o-e/2)/e;var s=4*(t*o+r),a=this.net.forward(n);i.data[0+s]=Math.floor(255*a.w[0]),i.data[1+s]=Math.floor(255*a.w[1]),i.data[2+s]=Math.floor(255*a.w[2]),i.data[3+s]=255}}this.netContext.putImageData(i,0,0)}}},{key:"filter",value:function(){var t=this.netContext.getImageData(0,0,this.defaultWidth,this.defaultHeight);this.replaceColors(t)}},{key:"replaceColors",value:function(t){var e=this,i=t.data,n=[];this.colorArray.forEach((function(t){n.push({hue:e.returnHSL(t.r,t.g,t.b).hue,saturation:e.returnHSL(t.r,t.g,t.b).saturation,lightness:e.returnHSL(t.r,t.g,t.b).lightness})}));for(var r=[],o=0;o<this.colorArray.length;o+=1)r[o]=0;for(var s=360/this.colorArray.length,a=[],u=0;u<this.colorArray.length;u+=1)a.push({min:0===u?0:u*s+1,max:0===u?s:(u+1)*s});for(var h=0;h<i.length;h+=4){for(var l=i[h],c=i[h+1],d=i[h+2],f=this.returnHSL(l,c,d),p=0;p<this.colorArray.length;p+=1){var m=a[p].min,_=a[p].max;f.hue<_&&f.hue>m&&(r[p]+=1)}for(var v=r.sort((function(t,e){return t-e})),y=[],g=0;g<v.length;g+=1)y[g]=this.colorArray.sort((function(t,e){return t.amount-e.amount}))[g];for(var w=1;w<=y.length;w+=1){var b=w-1==-1?0:w-1,x=w;f.hue<=360/y.length*x&&f.hue>=360/y.length*b&&(i[h]=y[w-1].r,i[h+1]=y[w-1].g,i[h+2]=y[w-1].b)}}this.colorCanvas.width=this.netCanvas.width,this.colorCanvas.height=this.netCanvas.height,this.colorContext=this.colorCanvas.getContext("2d"),this.colorContext.putImageData(new ImageData(i,this.netCanvas.width,this.netCanvas.height),0,0),this.getOutline(this.colorCanvas.getContext("2d"))}},{key:"returnHSL",value:function(t,e,i){t/=255,e/=255,i/=255;var n=Math.min(t,e,i),r=Math.max(t,e,i),o=r-n,s=0,a=0;return s=0==o?0:r==t?(e-i)/o%6:r==e?(i-t)/o+2:(t-e)/o+4,(s=Math.round(60*s))<0&&(s+=360),a=(r+n)/2,{hue:s,saturation:+(100*(0==o?0:o/(1-Math.abs(2*a-1)))).toFixed(1),lightness:a=+(100*a).toFixed(1)}}},{key:"getOutline",value:function(t){var e=t.getImageData(0,0,this.defaultWidth,this.defaultHeight),i=0,n=0,r=void 0,o=void 0,s=void 0,a=void 0;for(this.outlineCanvas.width=this.defaultWidth,this.outlineCanvas.height=this.defaultHeight,n=0;n<this.defaultHeight;n+=1)for(i=0;i<this.defaultWidth;i+=1){var u=4*(i+n*this.defaultWidth),h=this.returnHSL(e.data[u],e.data[1+u],e.data[2+u]),l=4*(i-1+n*this.defaultWidth),c=4*(i+1+n*this.defaultWidth),d=4*(i+(n-1)*this.defaultWidth),f=4*(i+(n+1)*this.defaultWidth);i%Math.floor(this.defaultWidth/30)==0&&n%Math.floor(this.defaultWidth/30)==0&&this.plotText(i,n,this.outlineCanvas,h),r=this.returnHSL(e.data[l],e.data[1+l],e.data[2+l]),s=this.returnHSL(e.data[c],e.data[1+c],e.data[2+c]),o=this.returnHSL(e.data[d],e.data[1+d],e.data[2+d]),a=this.returnHSL(e.data[f],e.data[1+f],e.data[2+f]),h.hue===r.hue&&h.hue===s.hue&&h.hue===a.hue&&h.hue===o.hue||this.plotPoint(i,n,this.outlineCanvas)}this.createPolygon()}},{key:"plotPoint",value:function(t,e,i){i.getContext("2d").fillStyle="black",i.getContext("2d").fillRect(t,e,1,1),i.getContext("2d").fill()}},{key:"plotText",value:function(t,e,i,n){var r=this,o=this.colorArray.find((function(t){return r.returnHSL(t.r,t.g,t.b).hue===n.hue&&r.returnHSL(t.r,t.g,t.b).saturation===n.saturation})).name,s=i.getContext("2d");s.font="15px Courier New",s.fillStyle="black",s.textAlign="center",s.fillText(o,t,e+7)}},{key:"createPolygon",value:function(){this.finalCanvas.width=this.defaultWidth,this.finalCanvas.height=this.defaultHeight;var t=this.finalCanvas.getContext("2d");this.widthThirds=this.defaultWidth/3,this.heightThirds=this.defaultHeight/3,t.rect(0,0,this.defaultWidth,this.defaultHeight),t.fillStyle="white",t.fill();for(var e=0;e<=3;e+=1)if(0===e){var i=[];i.push(this.getRandomInt(10,+this.widthThirds)),i.push(this.getRandomInt(10,+this.heightThirds)),this.polygonArray.push(i)}else if(1===e){var n=[];n.push(this.getRandomInt(2*this.widthThirds,this.defaultWidth-10)),n.push(this.getRandomInt(10,+this.heightThirds)),this.polygonArray.push(n)}else if(2===e){var r=[];r.push(this.getRandomInt(2*this.widthThirds,this.defaultWidth-10)),r.push(this.getRandomInt(2*this.heightThirds+10,this.defaultHeight-10)),this.polygonArray.push(r)}else if(3===e){var o=[];o.push(this.getRandomInt(10,+this.widthThirds)),o.push(this.getRandomInt(2*this.heightThirds,this.defaultHeight-10)),this.polygonArray.push(o)}0!==this.polygonArray.length&&(t.save(),t.beginPath(),this.polygonArray.forEach((function(e,i){0===i?t.moveTo(e[0],e[1]):t.lineTo(e[0],e[1])})),t.closePath(),t.stroke(),t.clip(),t.save(),t.drawImage(this.outlineCanvas,0,0,this.defaultWidth,this.defaultHeight),t.restore()),this.createDownload()}},{key:"getRandomInt",value:function(t,e){return t=Math.ceil(t),e=Math.floor(e),Math.floor(Math.random()*(e-t))+t}},{key:"createDownload",value:function(){var t=this;r()(this.element.querySelectorAll("canvas")).forEach((function(e){var i=document.createElement("a"),n=e.id.split("--")[1];i.setAttribute("download","".concat((new Date).toLocaleDateString("de-DE"),"__").concat(n,".png")),i.setAttribute("href",e.toDataURL("image/png").replace("image/png","image/octet-stream")),i.innerHTML="Download ".concat(n.toUpperCase()),t.element.appendChild(i)}))}},{key:"hexToRgb",value:function(t){var e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return e?{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)}:null}}]),t}();u()(),window.sharedObjects=window.sharedObjects||{},document.addEventListener("DOMContentLoaded",(function(){!function(){var t=function(){var t={ScriptContainer:E},e=window.classesAdditional||{};return Object.assign({},t,e)}(),e=document.querySelectorAll("[data-module]");window.initializedModuleInstances=r()(e).map((function(e){var i=e.getAttribute("data-module");try{if(""===i)return null;var n=new t[i]({element:e});return n.init(),n}catch(e){return null}}))}(),new s.a({elements_selector:".lazy img, img.lazy",treshold:300})}))}]);
//# sourceMappingURL=bundle.js.map
