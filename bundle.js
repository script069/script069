!function(t){var e={};function i(s){if(e[s])return e[s].exports;var r=e[s]={i:s,l:!1,exports:{}};return t[s].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)i.d(s,r,function(e){return t[e]}.bind(null,r));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="/",i(i.s=25)}([function(t,e,i){t.exports="function"==typeof Array.from?Array.from:i(13)},function(t,e,i){var s=s||{REVISION:"ALPHA"};!function(t){"use strict";function e(t,e){return Math.random()*(e-t)+t}function i(t,e){for(var i=0,s=t.length;i<s;i++)if(t[i]===e)return!0;return!1}var s=!1,r=0,n=function(){if(s)return s=!1,r;var t=2*Math.random()-1,e=2*Math.random()-1,i=t*t+e*e;if(0==i||1<i)return n();var o=Math.sqrt(-2*Math.log(i)/i);return r=e*o,s=!0,t*o};t.randf=e,t.randi=function(t,e){return Math.floor(Math.random()*(e-t)+t)},t.randn=function(t,e){return t+n()*e},t.zeros=function(t){if(void 0===t||isNaN(t))return[];if("undefined"!=typeof ArrayBuffer)return new Float64Array(t);for(var e=new Array(t),i=0;i<t;i++)e[i]=0;return e},t.maxmin=function(t){if(0===t.length)return{};for(var e=t[0],i=t[0],s=0,r=0,n=t.length,o=1;o<n;o++)t[o]>e&&(e=t[o],s=o),t[o]<i&&(i=t[o],r=o);return{maxi:s,maxv:e,mini:r,minv:i,dv:e-i}},t.randperm=function(t){for(var e,i=t,s=0,r=[],n=0;n<t;n++)r[n]=n;for(;i--;)s=Math.floor(Math.random()*(i+1)),e=r[i],r[i]=r[s],r[s]=e;return r},t.weightedSample=function(t,i){for(var s=e(0,1),r=0,n=0,o=t.length;n<o;n++)if(s<(r+=i[n]))return t[n]},t.arrUnique=function(t){for(var e=[],s=0,r=t.length;s<r;s++)i(e,t[s])||e.push(t[s]);return e},t.arrContains=i,t.getopt=function(t,e,i){return void 0!==t[e]?t[e]:i}}(s),function(t){"use strict";function e(e,i,s,r){if("[object Array]"===Object.prototype.toString.call(e)){this.sx=1,this.sy=1,this.depth=e.length,this.w=t.zeros(this.depth),this.dw=t.zeros(this.depth);for(var n=0;n<this.depth;n++)this.w[n]=e[n]}else{var o=(this.sx=e)*(this.sy=i)*(this.depth=s);if(this.w=t.zeros(o),this.dw=t.zeros(o),void 0===r){var a=Math.sqrt(1/(e*i*s));for(n=0;n<o;n++)this.w[n]=t.randn(0,a)}else for(n=0;n<o;n++)this.w[n]=r}}e.prototype={get:function(t,e,i){var s=(this.sx*e+t)*this.depth+i;return this.w[s]},set:function(t,e,i,s){var r=(this.sx*e+t)*this.depth+i;this.w[r]=s},add:function(t,e,i,s){var r=(this.sx*e+t)*this.depth+i;this.w[r]+=s},get_grad:function(t,e,i){var s=(this.sx*e+t)*this.depth+i;return this.dw[s]},set_grad:function(t,e,i,s){var r=(this.sx*e+t)*this.depth+i;this.dw[r]=s},add_grad:function(t,e,i,s){var r=(this.sx*e+t)*this.depth+i;this.dw[r]+=s},cloneAndZero:function(){return new e(this.sx,this.sy,this.depth,0)},clone:function(){for(var t=new e(this.sx,this.sy,this.depth,0),i=this.w.length,s=0;s<i;s++)t.w[s]=this.w[s];return t},addFrom:function(t){for(var e=0;e<this.w.length;e++)this.w[e]+=t.w[e]},addFromScaled:function(t,e){for(var i=0;i<this.w.length;i++)this.w[i]+=e*t.w[i]},setConst:function(t){for(var e=0;e<this.w.length;e++)this.w[e]=t},toJSON:function(){var t={};return t.sx=this.sx,t.sy=this.sy,t.depth=this.depth,t.w=this.w,t},fromJSON:function(e){this.sx=e.sx,this.sy=e.sy,this.depth=e.depth;var i=this.sx*this.sy*this.depth;this.w=t.zeros(i),this.dw=t.zeros(i);for(var s=0;s<i;s++)this.w[s]=e.w[s]}},t.Vol=e}(s),function(t){"use strict";var e=t.Vol;t.augment=function(i,s,r,n,o){var a;if(void 0===o&&(o=!1),void 0===r&&(r=t.randi(0,i.sx-s)),void 0===n&&(n=t.randi(0,i.sy-s)),s!==i.sx||0!==r||0!==n){a=new e(s,s,i.depth,0);for(var h=0;h<s;h++)for(var u=0;u<s;u++)if(!(h+r<0||h+r>=i.sx||u+n<0||u+n>=i.sy))for(var l=0;l<i.depth;l++)a.set(h,u,l,i.get(h+r,u+n,l))}else a=i;if(o){var c=a.cloneAndZero();for(h=0;h<a.sx;h++)for(u=0;u<a.sy;u++)for(l=0;l<a.depth;l++)c.set(h,u,l,a.get(a.sx-h-1,u,l));a=c}return a},t.img_to_vol=function(t,i){void 0===i&&(i=!1);var s=document.createElement("canvas");s.width=t.width,s.height=t.height;var r=s.getContext("2d");try{r.drawImage(t,0,0)}catch(t){if("NS_ERROR_NOT_AVAILABLE"===t.name)return!1;throw t}try{var n=r.getImageData(0,0,s.width,s.height)}catch(t){if("IndexSizeError"===t.name)return!1;throw t}for(var o=n.data,a=t.width,h=t.height,u=[],l=0;l<o.length;l++)u.push(o[l]/255-.5);var c=new e(a,h,4,0);if(c.w=u,i){var d=new e(a,h,1,0);for(l=0;l<a;l++)for(var _=0;_<h;_++)d.set(l,_,0,c.get(l,_,0));c=d}return c}}(s),function(t){"use strict";function e(t){t=t||{},this.out_depth=t.filters,this.sx=t.sx,this.in_depth=t.in_depth,this.in_sx=t.in_sx,this.in_sy=t.in_sy,this.sy=void 0!==t.sy?t.sy:this.sx,this.stride=void 0!==t.stride?t.stride:1,this.pad=void 0!==t.pad?t.pad:0,this.l1_decay_mul=void 0!==t.l1_decay_mul?t.l1_decay_mul:0,this.l2_decay_mul=void 0!==t.l2_decay_mul?t.l2_decay_mul:1,this.out_sx=Math.floor((this.in_sx+2*this.pad-this.sx)/this.stride+1),this.out_sy=Math.floor((this.in_sy+2*this.pad-this.sy)/this.stride+1),this.layer_type="conv";var e=void 0!==t.bias_pref?t.bias_pref:0;this.filters=[];for(var s=0;s<this.out_depth;s++)this.filters.push(new i(this.sx,this.sy,this.in_depth));this.biases=new i(1,1,this.out_depth,e)}var i=t.Vol;function s(t){t=t||{},this.out_depth=void 0!==t.num_neurons?t.num_neurons:t.filters,this.l1_decay_mul=void 0!==t.l1_decay_mul?t.l1_decay_mul:0,this.l2_decay_mul=void 0!==t.l2_decay_mul?t.l2_decay_mul:1,this.num_inputs=t.in_sx*t.in_sy*t.in_depth,this.out_sx=1,this.out_sy=1,this.layer_type="fc";var e=void 0!==t.bias_pref?t.bias_pref:0;this.filters=[];for(var s=0;s<this.out_depth;s++)this.filters.push(new i(1,1,this.num_inputs));this.biases=new i(1,1,this.out_depth,e)}e.prototype={forward:function(t,e){this.in_act=t;for(var s=new i(this.out_sx,this.out_sy,this.out_depth,0),r=0;r<this.out_depth;r++)for(var n=this.filters[r],o=-this.pad,a=-this.pad,h=0;h<this.out_sx;o+=this.stride,h++){a=-this.pad;for(var u=0;u<this.out_sy;a+=this.stride,u++){for(var l=0,c=0;c<n.sx;c++)for(var d=0;d<n.sy;d++)for(var _=0;_<n.depth;_++){var f=a+d,p=o+c;0<=f&&f<t.sy&&0<=p&&p<t.sx&&(l+=n.w[(n.sx*d+c)*n.depth+_]*t.w[(t.sx*f+p)*t.depth+_])}l+=this.biases.w[r],s.set(h,u,r,l)}}return this.out_act=s,this.out_act},backward:function(){var e=this.in_act;e.dw=t.zeros(e.w.length);for(var i=0;i<this.out_depth;i++)for(var s=this.filters[i],r=-this.pad,n=-this.pad,o=0;o<this.out_sx;r+=this.stride,o++){n=-this.pad;for(var a=0;a<this.out_sy;n+=this.stride,a++){for(var h=this.out_act.get_grad(o,a,i),u=0;u<s.sx;u++)for(var l=0;l<s.sy;l++)for(var c=0;c<s.depth;c++){var d=n+l,_=r+u;if(0<=d&&d<e.sy&&0<=_&&_<e.sx){var f=(e.sx*d+_)*e.depth+c,p=(s.sx*l+u)*s.depth+c;s.dw[p]+=e.w[f]*h,e.dw[f]+=s.w[p]*h}}this.biases.dw[i]+=h}}},getParamsAndGrads:function(){for(var t=[],e=0;e<this.out_depth;e++)t.push({params:this.filters[e].w,grads:this.filters[e].dw,l2_decay_mul:this.l2_decay_mul,l1_decay_mul:this.l1_decay_mul});return t.push({params:this.biases.w,grads:this.biases.dw,l1_decay_mul:0,l2_decay_mul:0}),t},toJSON:function(){var t={};t.sx=this.sx,t.sy=this.sy,t.stride=this.stride,t.in_depth=this.in_depth,t.out_depth=this.out_depth,t.out_sx=this.out_sx,t.out_sy=this.out_sy,t.layer_type=this.layer_type,t.l1_decay_mul=this.l1_decay_mul,t.l2_decay_mul=this.l2_decay_mul,t.pad=this.pad,t.filters=[];for(var e=0;e<this.filters.length;e++)t.filters.push(this.filters[e].toJSON());return t.biases=this.biases.toJSON(),t},fromJSON:function(t){this.out_depth=t.out_depth,this.out_sx=t.out_sx,this.out_sy=t.out_sy,this.layer_type=t.layer_type,this.sx=t.sx,this.sy=t.sy,this.stride=t.stride,this.in_depth=t.in_depth,this.filters=[],this.l1_decay_mul=void 0!==t.l1_decay_mul?t.l1_decay_mul:1,this.l2_decay_mul=void 0!==t.l2_decay_mul?t.l2_decay_mul:1,this.pad=void 0!==t.pad?t.pad:0;for(var e=0;e<t.filters.length;e++){var s=new i(0,0,0,0);s.fromJSON(t.filters[e]),this.filters.push(s)}this.biases=new i(0,0,0,0),this.biases.fromJSON(t.biases)}},s.prototype={forward:function(t,e){this.in_act=t;for(var s=new i(1,1,this.out_depth,0),r=t.w,n=0;n<this.out_depth;n++){for(var o=0,a=this.filters[n].w,h=0;h<this.num_inputs;h++)o+=r[h]*a[h];o+=this.biases.w[n],s.w[n]=o}return this.out_act=s,this.out_act},backward:function(){var e=this.in_act;e.dw=t.zeros(e.w.length);for(var i=0;i<this.out_depth;i++){for(var s=this.filters[i],r=this.out_act.dw[i],n=0;n<this.num_inputs;n++)e.dw[n]+=s.w[n]*r,s.dw[n]+=e.w[n]*r;this.biases.dw[i]+=r}},getParamsAndGrads:function(){for(var t=[],e=0;e<this.out_depth;e++)t.push({params:this.filters[e].w,grads:this.filters[e].dw,l1_decay_mul:this.l1_decay_mul,l2_decay_mul:this.l2_decay_mul});return t.push({params:this.biases.w,grads:this.biases.dw,l1_decay_mul:0,l2_decay_mul:0}),t},toJSON:function(){var t={};t.out_depth=this.out_depth,t.out_sx=this.out_sx,t.out_sy=this.out_sy,t.layer_type=this.layer_type,t.num_inputs=this.num_inputs,t.l1_decay_mul=this.l1_decay_mul,t.l2_decay_mul=this.l2_decay_mul,t.filters=[];for(var e=0;e<this.filters.length;e++)t.filters.push(this.filters[e].toJSON());return t.biases=this.biases.toJSON(),t},fromJSON:function(t){this.out_depth=t.out_depth,this.out_sx=t.out_sx,this.out_sy=t.out_sy,this.layer_type=t.layer_type,this.num_inputs=t.num_inputs,this.l1_decay_mul=void 0!==t.l1_decay_mul?t.l1_decay_mul:1,this.l2_decay_mul=void 0!==t.l2_decay_mul?t.l2_decay_mul:1,this.filters=[];for(var e=0;e<t.filters.length;e++){var s=new i(0,0,0,0);s.fromJSON(t.filters[e]),this.filters.push(s)}this.biases=new i(0,0,0,0),this.biases.fromJSON(t.biases)}},t.ConvLayer=e,t.FullyConnLayer=s}(s),function(t){"use strict";function e(e){e=e||{},this.sx=e.sx,this.in_depth=e.in_depth,this.in_sx=e.in_sx,this.in_sy=e.in_sy,this.sy=void 0!==e.sy?e.sy:this.sx,this.stride=void 0!==e.stride?e.stride:2,this.pad=void 0!==e.pad?e.pad:0,this.out_depth=this.in_depth,this.out_sx=Math.floor((this.in_sx+2*this.pad-this.sx)/this.stride+1),this.out_sy=Math.floor((this.in_sy+2*this.pad-this.sy)/this.stride+1),this.layer_type="pool",this.switchx=t.zeros(this.out_sx*this.out_sy*this.out_depth),this.switchy=t.zeros(this.out_sx*this.out_sy*this.out_depth)}var i=t.Vol;e.prototype={forward:function(t,e){this.in_act=t;for(var s=new i(this.out_sx,this.out_sy,this.out_depth,0),r=0,n=0;n<this.out_depth;n++)for(var o=-this.pad,a=-this.pad,h=0;h<this.out_sx;o+=this.stride,h++){a=-this.pad;for(var u=0;u<this.out_sy;a+=this.stride,u++){for(var l=-99999,c=-1,d=-1,_=0;_<this.sx;_++)for(var f=0;f<this.sy;f++){var p=a+f,y=o+_;if(0<=p&&p<t.sy&&0<=y&&y<t.sx){var v=t.get(y,p,n);l<v&&(l=v,c=y,d=p)}}this.switchx[r]=c,this.switchy[r]=d,r++,s.set(h,u,n,l)}}return this.out_act=s,this.out_act},backward:function(){var e=this.in_act;e.dw=t.zeros(e.w.length),this.out_act;for(var i=0,s=0;s<this.out_depth;s++){this.pad,this.pad;for(var r=0;r<this.out_sx;this.stride,r++){this.pad;for(var n=0;n<this.out_sy;this.stride,n++){var o=this.out_act.get_grad(r,n,s);e.add_grad(this.switchx[i],this.switchy[i],s,o),i++}}}},getParamsAndGrads:function(){return[]},toJSON:function(){var t={};return t.sx=this.sx,t.sy=this.sy,t.stride=this.stride,t.in_depth=this.in_depth,t.out_depth=this.out_depth,t.out_sx=this.out_sx,t.out_sy=this.out_sy,t.layer_type=this.layer_type,t.pad=this.pad,t},fromJSON:function(e){this.out_depth=e.out_depth,this.out_sx=e.out_sx,this.out_sy=e.out_sy,this.layer_type=e.layer_type,this.sx=e.sx,this.sy=e.sy,this.stride=e.stride,this.in_depth=e.in_depth,this.pad=void 0!==e.pad?e.pad:0,this.switchx=t.zeros(this.out_sx*this.out_sy*this.out_depth),this.switchy=t.zeros(this.out_sx*this.out_sy*this.out_depth)}},t.PoolLayer=e}(s),function(t){"use strict";function e(t){t=t||{},this.out_sx=void 0!==t.out_sx?t.out_sx:t.in_sx,this.out_sy=void 0!==t.out_sy?t.out_sy:t.in_sy,this.out_depth=void 0!==t.out_depth?t.out_depth:t.in_depth,this.layer_type="input"}t.Vol,e.prototype={forward:function(t,e){return this.in_act=t,this.out_act=t,this.out_act},backward:function(){},getParamsAndGrads:function(){return[]},toJSON:function(){var t={};return t.out_depth=this.out_depth,t.out_sx=this.out_sx,t.out_sy=this.out_sy,t.layer_type=this.layer_type,t},fromJSON:function(t){this.out_depth=t.out_depth,this.out_sx=t.out_sx,this.out_sy=t.out_sy,this.layer_type=t.layer_type}},t.InputLayer=e}(s),function(t){"use strict";function e(t){t=t||{},this.num_inputs=t.in_sx*t.in_sy*t.in_depth,this.out_depth=this.num_inputs,this.out_sx=1,this.out_sy=1,this.layer_type="softmax"}var i=t.Vol;function s(t){t=t||{},this.num_inputs=t.in_sx*t.in_sy*t.in_depth,this.out_depth=this.num_inputs,this.out_sx=1,this.out_sy=1,this.layer_type="regression"}function r(t){t=t||{},this.num_inputs=t.in_sx*t.in_sy*t.in_depth,this.out_depth=this.num_inputs,this.out_sx=1,this.out_sy=1,this.layer_type="svm"}e.prototype={forward:function(e,s){this.in_act=e;for(var r=new i(1,1,this.out_depth,0),n=e.w,o=e.w[0],a=1;a<this.out_depth;a++)n[a]>o&&(o=n[a]);var h=t.zeros(this.out_depth),u=0;for(a=0;a<this.out_depth;a++){var l=Math.exp(n[a]-o);u+=l,h[a]=l}for(a=0;a<this.out_depth;a++)h[a]/=u,r.w[a]=h[a];return this.es=h,this.out_act=r,this.out_act},backward:function(e){var i=this.in_act;i.dw=t.zeros(i.w.length);for(var s=0;s<this.out_depth;s++){var r=-((s===e?1:0)-this.es[s]);i.dw[s]=r}return-Math.log(this.es[e])},getParamsAndGrads:function(){return[]},toJSON:function(){var t={};return t.out_depth=this.out_depth,t.out_sx=this.out_sx,t.out_sy=this.out_sy,t.layer_type=this.layer_type,t.num_inputs=this.num_inputs,t},fromJSON:function(t){this.out_depth=t.out_depth,this.out_sx=t.out_sx,this.out_sy=t.out_sy,this.layer_type=t.layer_type,this.num_inputs=t.num_inputs}},s.prototype={forward:function(t,e){return this.in_act=t,this.out_act=t},backward:function(e){var i=this.in_act;i.dw=t.zeros(i.w.length);var s=0;if(e instanceof Array||e instanceof Float64Array)for(var r=0;r<this.out_depth;r++){var n=i.w[r]-e[r];s+=2*(i.dw[r]=n)*n}else{r=e.dim;var o=e.val;n=i.w[r]-o,s+=2*(i.dw[r]=n)*n}return s},getParamsAndGrads:function(){return[]},toJSON:function(){var t={};return t.out_depth=this.out_depth,t.out_sx=this.out_sx,t.out_sy=this.out_sy,t.layer_type=this.layer_type,t.num_inputs=this.num_inputs,t},fromJSON:function(t){this.out_depth=t.out_depth,this.out_sx=t.out_sx,this.out_sy=t.out_sy,this.layer_type=t.layer_type,this.num_inputs=t.num_inputs}},r.prototype={forward:function(t,e){return this.in_act=t,this.out_act=t},backward:function(e){var i=this.in_act;i.dw=t.zeros(i.w.length);for(var s=i.w[e],r=0,n=0;n<this.out_depth;n++)0<-s+i.w[n]+1&&(i.dw[n]+=1,--i.dw[e],r+=-s+i.w[n]+1);return r},getParamsAndGrads:function(){return[]},toJSON:function(){var t={};return t.out_depth=this.out_depth,t.out_sx=this.out_sx,t.out_sy=this.out_sy,t.layer_type=this.layer_type,t.num_inputs=this.num_inputs,t},fromJSON:function(t){this.out_depth=t.out_depth,this.out_sx=t.out_sx,this.out_sy=t.out_sy,this.layer_type=t.layer_type,this.num_inputs=t.num_inputs}},t.RegressionLayer=s,t.SoftmaxLayer=e,t.SVMLayer=r}(s),function(t){"use strict";function e(t){t=t||{},this.out_sx=t.in_sx,this.out_sy=t.in_sy,this.out_depth=t.in_depth,this.layer_type="relu"}var i=t.Vol;function s(t){t=t||{},this.out_sx=t.in_sx,this.out_sy=t.in_sy,this.out_depth=t.in_depth,this.layer_type="sigmoid"}function r(e){e=e||{},this.group_size=void 0!==e.group_size?e.group_size:2,this.out_sx=e.in_sx,this.out_sy=e.in_sy,this.out_depth=Math.floor(e.in_depth/this.group_size),this.layer_type="maxout",this.switches=t.zeros(this.out_sx*this.out_sy*this.out_depth)}function n(t){var e=Math.exp(2*t);return(e-1)/(e+1)}function o(t){t=t||{},this.out_sx=t.in_sx,this.out_sy=t.in_sy,this.out_depth=t.in_depth,this.layer_type="tanh"}e.prototype={forward:function(t,e){for(var i=(this.in_act=t).clone(),s=t.w.length,r=i.w,n=0;n<s;n++)r[n]<0&&(r[n]=0);return this.out_act=i,this.out_act},backward:function(){var e=this.in_act,i=this.out_act,s=e.w.length;e.dw=t.zeros(s);for(var r=0;r<s;r++)i.w[r]<=0?e.dw[r]=0:e.dw[r]=i.dw[r]},getParamsAndGrads:function(){return[]},toJSON:function(){var t={};return t.out_depth=this.out_depth,t.out_sx=this.out_sx,t.out_sy=this.out_sy,t.layer_type=this.layer_type,t},fromJSON:function(t){this.out_depth=t.out_depth,this.out_sx=t.out_sx,this.out_sy=t.out_sy,this.layer_type=t.layer_type}},s.prototype={forward:function(t,e){for(var i=(this.in_act=t).cloneAndZero(),s=t.w.length,r=i.w,n=t.w,o=0;o<s;o++)r[o]=1/(1+Math.exp(-n[o]));return this.out_act=i,this.out_act},backward:function(){var e=this.in_act,i=this.out_act,s=e.w.length;e.dw=t.zeros(s);for(var r=0;r<s;r++){var n=i.w[r];e.dw[r]=n*(1-n)*i.dw[r]}},getParamsAndGrads:function(){return[]},toJSON:function(){var t={};return t.out_depth=this.out_depth,t.out_sx=this.out_sx,t.out_sy=this.out_sy,t.layer_type=this.layer_type,t},fromJSON:function(t){this.out_depth=t.out_depth,this.out_sx=t.out_sx,this.out_sy=t.out_sy,this.layer_type=t.layer_type}},r.prototype={forward:function(t,e){this.in_act=t;var s=this.out_depth,r=new i(this.out_sx,this.out_sy,this.out_depth,0);if(1===this.out_sx&&1===this.out_sy)for(var n=0;n<s;n++){for(var o=n*this.group_size,a=t.w[o],h=0,u=1;u<this.group_size;u++)a<(_=t.w[o+u])&&(a=_,h=u);r.w[n]=a,this.switches[n]=o+h}else for(var l=0,c=0;c<t.sx;c++)for(var d=0;d<t.sy;d++)for(n=0;n<s;n++){for(o=n*this.group_size,a=t.get(c,d,o),h=0,u=1;u<this.group_size;u++){var _;a<(_=t.get(c,d,o+u))&&(a=_,h=u)}r.set(c,d,n,a),this.switches[l]=o+h,l++}return this.out_act=r,this.out_act},backward:function(){var e=this.in_act,i=this.out_act,s=this.out_depth;if(e.dw=t.zeros(e.w.length),1===this.out_sx&&1===this.out_sy)for(var r=0;r<s;r++){var n=i.dw[r];e.dw[this.switches[r]]=n}else for(var o=0,a=0;a<i.sx;a++)for(var h=0;h<i.sy;h++)for(r=0;r<s;r++)n=i.get_grad(a,h,r),e.set_grad(a,h,this.switches[o],n),o++},getParamsAndGrads:function(){return[]},toJSON:function(){var t={};return t.out_depth=this.out_depth,t.out_sx=this.out_sx,t.out_sy=this.out_sy,t.layer_type=this.layer_type,t.group_size=this.group_size,t},fromJSON:function(e){this.out_depth=e.out_depth,this.out_sx=e.out_sx,this.out_sy=e.out_sy,this.layer_type=e.layer_type,this.group_size=e.group_size,this.switches=t.zeros(this.group_size)}},o.prototype={forward:function(t,e){for(var i=(this.in_act=t).cloneAndZero(),s=t.w.length,r=0;r<s;r++)i.w[r]=n(t.w[r]);return this.out_act=i,this.out_act},backward:function(){var e=this.in_act,i=this.out_act,s=e.w.length;e.dw=t.zeros(s);for(var r=0;r<s;r++){var n=i.w[r];e.dw[r]=(1-n*n)*i.dw[r]}},getParamsAndGrads:function(){return[]},toJSON:function(){var t={};return t.out_depth=this.out_depth,t.out_sx=this.out_sx,t.out_sy=this.out_sy,t.layer_type=this.layer_type,t},fromJSON:function(t){this.out_depth=t.out_depth,this.out_sx=t.out_sx,this.out_sy=t.out_sy,this.layer_type=t.layer_type}},t.TanhLayer=o,t.MaxoutLayer=r,t.ReluLayer=e,t.SigmoidLayer=s}(s),function(t){"use strict";function e(e){e=e||{},this.out_sx=e.in_sx,this.out_sy=e.in_sy,this.out_depth=e.in_depth,this.layer_type="dropout",this.drop_prob=void 0!==e.drop_prob?e.drop_prob:.5,this.dropped=t.zeros(this.out_sx*this.out_sy*this.out_depth)}t.Vol,e.prototype={forward:function(t,e){void 0===e&&(e=!1);var i=(this.in_act=t).clone(),s=t.w.length;if(e)for(var r=0;r<s;r++)Math.random()<this.drop_prob?(i.w[r]=0,this.dropped[r]=!0):this.dropped[r]=!1;else for(r=0;r<s;r++)i.w[r]*=this.drop_prob;return this.out_act=i,this.out_act},backward:function(){var e=this.in_act,i=this.out_act,s=e.w.length;e.dw=t.zeros(s);for(var r=0;r<s;r++)this.dropped[r]||(e.dw[r]=i.dw[r])},getParamsAndGrads:function(){return[]},toJSON:function(){var t={};return t.out_depth=this.out_depth,t.out_sx=this.out_sx,t.out_sy=this.out_sy,t.layer_type=this.layer_type,t.drop_prob=this.drop_prob,t},fromJSON:function(t){this.out_depth=t.out_depth,this.out_sx=t.out_sx,this.out_sy=t.out_sy,this.layer_type=t.layer_type,this.drop_prob=t.drop_prob}},t.DropoutLayer=e}(s),function(t){"use strict";function e(t){t=t||{},this.k=t.k,this.n=t.n,this.alpha=t.alpha,this.beta=t.beta,this.out_sx=t.in_sx,this.out_sy=t.in_sy,this.out_depth=t.in_depth,this.layer_type="lrn",this.n}t.Vol,e.prototype={forward:function(t,e){var i=(this.in_act=t).cloneAndZero();this.S_cache_=t.cloneAndZero();for(var s=Math.floor(this.n/2),r=0;r<t.sx;r++)for(var n=0;n<t.sy;n++)for(var o=0;o<t.depth;o++){for(var a=t.get(r,n,o),h=0,u=Math.max(0,o-s);u<=Math.min(o+s,t.depth-1);u++){var l=t.get(r,n,u);h+=l*l}h*=this.alpha/this.n,h+=this.k,this.S_cache_.set(r,n,o,h),h=Math.pow(h,this.beta),i.set(r,n,o,a/h)}return this.out_act=i,this.out_act},backward:function(){var e=this.in_act;e.dw=t.zeros(e.w.length),this.out_act;for(var i=Math.floor(this.n/2),s=0;s<e.sx;s++)for(var r=0;r<e.sy;r++)for(var n=0;n<e.depth;n++)for(var o=this.out_act.get_grad(s,r,n),a=this.S_cache_.get(s,r,n),h=Math.pow(a,this.beta),u=h*h,l=Math.max(0,n-i);l<=Math.min(n+i,e.depth-1);l++){var c=e.get(s,r,l),d=-c*this.beta*Math.pow(a,this.beta-1)*this.alpha/this.n*2*c;l===n&&(d+=h),d/=u,d*=o,e.add_grad(s,r,l,d)}},getParamsAndGrads:function(){return[]},toJSON:function(){var t={};return t.k=this.k,t.n=this.n,t.alpha=this.alpha,t.beta=this.beta,t.out_sx=this.out_sx,t.out_sy=this.out_sy,t.out_depth=this.out_depth,t.layer_type=this.layer_type,t},fromJSON:function(t){this.k=t.k,this.n=t.n,this.alpha=t.alpha,this.beta=t.beta,this.out_sx=t.out_sx,this.out_sy=t.out_sy,this.out_depth=t.out_depth,this.layer_type=t.layer_type}},t.LocalResponseNormalizationLayer=e}(s),function(t){"use strict";function e(t){t=t||{},this.out_sx=t.in_sx,this.out_sy=t.in_sy,this.out_depth=t.in_depth+t.in_depth*t.in_depth,this.layer_type="quadtransform"}var i=t.Vol;e.prototype={forward:function(t,e){this.in_act=t;for(var s=this.out_depth,r=t.depth,n=new i(this.out_sx,this.out_sy,this.out_depth,0),o=0;o<t.sx;o++)for(var a=0;a<t.sy;a++)for(var h=0;h<s;h++)if(h<r)n.set(o,a,h,t.get(o,a,h));else{var u=Math.floor((h-r)/r),l=h-r-u*r;n.set(o,a,h,t.get(o,a,u)*t.get(o,a,l))}return this.out_act=n,this.out_act},backward:function(){var e=this.in_act;e.dw=t.zeros(e.w.length);for(var i=this.out_act,s=this.out_depth,r=e.depth,n=0;n<e.sx;n++)for(var o=0;o<e.sy;o++)for(var a=0;a<s;a++){var h=i.get_grad(n,o,a);if(a<r)e.add_grad(n,o,a,h);else{var u=Math.floor((a-r)/r),l=a-r-u*r;e.add_grad(n,o,u,e.get(n,o,l)*h),e.add_grad(n,o,l,e.get(n,o,u)*h)}}},getParamsAndGrads:function(){return[]},toJSON:function(){var t={};return t.out_depth=this.out_depth,t.out_sx=this.out_sx,t.out_sy=this.out_sy,t.layer_type=this.layer_type,t},fromJSON:function(t){this.out_depth=t.out_depth,this.out_sx=t.out_sx,this.out_sy=t.out_sy,this.layer_type=t.layer_type}},t.QuadTransformLayer=e}(s),function(t){"use strict";function e(t){this.layers=[]}t.Vol,e.prototype={makeLayers:function(e){e.length,e[0].type,e=function(){for(var t=[],i=0;i<e.length;i++){var s=e[i];if("softmax"!==s.type&&"svm"!==s.type||t.push({type:"fc",num_neurons:s.num_classes}),"regression"===s.type&&t.push({type:"fc",num_neurons:s.num_neurons}),"fc"!==s.type&&"conv"!==s.type||void 0!==s.bias_pref||void(s.bias_pref=0)!==s.activation&&"relu"===s.activation&&(s.bias_pref=.1),void 0!==s.tensor&&s.tensor&&t.push({type:"quadtransform"}),t.push(s),void 0!==s.activation)if("relu"===s.activation)t.push({type:"relu"});else if("sigmoid"===s.activation)t.push({type:"sigmoid"});else if("tanh"===s.activation)t.push({type:"tanh"});else if("maxout"===s.activation){var r="undefined"!==s.group_size?s.group_size:2;t.push({type:"maxout",group_size:r})}void 0!==s.drop_prob&&"dropout"!==s.type&&t.push({type:"dropout",drop_prob:s.drop_prob})}return t}(),this.layers=[];for(var i=0;i<e.length;i++){var s=e[i];if(0<i){var r=this.layers[i-1];s.in_sx=r.out_sx,s.in_sy=r.out_sy,s.in_depth=r.out_depth}switch(s.type){case"fc":this.layers.push(new t.FullyConnLayer(s));break;case"lrn":this.layers.push(new t.LocalResponseNormalizationLayer(s));break;case"dropout":this.layers.push(new t.DropoutLayer(s));break;case"input":this.layers.push(new t.InputLayer(s));break;case"softmax":this.layers.push(new t.SoftmaxLayer(s));break;case"regression":this.layers.push(new t.RegressionLayer(s));break;case"conv":this.layers.push(new t.ConvLayer(s));break;case"pool":this.layers.push(new t.PoolLayer(s));break;case"relu":this.layers.push(new t.ReluLayer(s));break;case"sigmoid":this.layers.push(new t.SigmoidLayer(s));break;case"tanh":this.layers.push(new t.TanhLayer(s));break;case"maxout":this.layers.push(new t.MaxoutLayer(s));break;case"quadtransform":this.layers.push(new t.QuadTransformLayer(s));break;case"svm":this.layers.push(new t.SVMLayer(s))}}},forward:function(t,e){void 0===e&&(e=!1);for(var i=this.layers[0].forward(t,e),s=1;s<this.layers.length;s++)i=this.layers[s].forward(i,e);return i},backward:function(t){for(var e=this.layers.length,i=this.layers[e-1].backward(t),s=e-2;0<=s;s--)this.layers[s].backward();return i},getParamsAndGrads:function(){for(var t=[],e=0;e<this.layers.length;e++)for(var i=this.layers[e].getParamsAndGrads(),s=0;s<i.length;s++)t.push(i[s]);return t},getPrediction:function(){for(var t=this.layers[this.layers.length-1].out_act.w,e=t[0],i=0,s=1;s<t.length;s++)t[s]>e&&(e=t[s],i=s);return i},toJSON:function(){for(var t={layers:[]},e=0;e<this.layers.length;e++)t.layers.push(this.layers[e].toJSON());return t},fromJSON:function(e){this.layers=[];for(var i=0;i<e.layers.length;i++){var s,r=e.layers[i],n=r.layer_type;"input"===n&&(s=new t.InputLayer),"relu"===n&&(s=new t.ReluLayer),"sigmoid"===n&&(s=new t.SigmoidLayer),"tanh"===n&&(s=new t.TanhLayer),"dropout"===n&&(s=new t.DropoutLayer),"conv"===n&&(s=new t.ConvLayer),"pool"===n&&(s=new t.PoolLayer),"lrn"===n&&(s=new t.LocalResponseNormalizationLayer),"softmax"===n&&(s=new t.SoftmaxLayer),"regression"===n&&(s=new t.RegressionLayer),"fc"===n&&(s=new t.FullyConnLayer),"maxout"===n&&(s=new t.MaxoutLayer),"quadtransform"===n&&(s=new t.QuadTransformLayer),"svm"===n&&(s=new t.SVMLayer),s.fromJSON(r),this.layers.push(s)}}},t.Net=e}(s),function(t){"use strict";function e(t,e){this.net=t,e=e||{},this.learning_rate=void 0!==e.learning_rate?e.learning_rate:.01,this.l1_decay=void 0!==e.l1_decay?e.l1_decay:0,this.l2_decay=void 0!==e.l2_decay?e.l2_decay:0,this.batch_size=void 0!==e.batch_size?e.batch_size:1,this.method=void 0!==e.method?e.method:"sgd",this.momentum=void 0!==e.momentum?e.momentum:.9,this.ro=void 0!==e.ro?e.ro:.95,this.eps=void 0!==e.eps?e.eps:1e-6,this.k=0,this.gsum=[],this.xsum=[]}t.Vol,e.prototype={train:function(e,i){var s=(new Date).getTime();this.net.forward(e,!0);var r=(new Date).getTime()-s,n=(s=(new Date).getTime(),this.net.backward(i)),o=0,a=0,h=(new Date).getTime()-s;if(this.k++,this.k%this.batch_size==0){var u=this.net.getParamsAndGrads();if(0===this.gsum.length&&("sgd"!==this.method||0<this.momentum))for(var l=0;l<u.length;l++)this.gsum.push(t.zeros(u[l].params.length)),"adadelta"===this.method?this.xsum.push(t.zeros(u[l].params.length)):this.xsum.push([]);for(l=0;l<u.length;l++)for(var c=u[l],d=c.params,_=c.grads,f=void 0!==c.l2_decay_mul?c.l2_decay_mul:1,p=void 0!==c.l1_decay_mul?c.l1_decay_mul:1,y=this.l2_decay*f,v=this.l1_decay*p,m=d.length,g=0;g<m;g++){o+=y*d[g]*d[g]/2,a+=v*Math.abs(d[g]);var w=v*(0<d[g]?1:-1),b=(y*d[g]+w+_[g])/this.batch_size,x=this.gsum[l],S=this.xsum[l];if("adagrad"===this.method){x[g]=x[g]+b*b;var O=-this.learning_rate/Math.sqrt(x[g]+this.eps)*b;d[g]+=O}else"windowgrad"===this.method?(x[g]=this.ro*x[g]+(1-this.ro)*b*b,O=-this.learning_rate/Math.sqrt(x[g]+this.eps)*b,d[g]+=O):"adadelta"===this.method?(x[g]=this.ro*x[g]+(1-this.ro)*b*b,O=-Math.sqrt((S[g]+this.eps)/(x[g]+this.eps))*b,S[g]=this.ro*S[g]+(1-this.ro)*O*O,d[g]+=O):0<this.momentum?(O=this.momentum*x[g]-this.learning_rate*b,x[g]=O,d[g]+=O):d[g]+=-this.learning_rate*b;_[g]=0}}return{fwd_time:r,bwd_time:h,l2_decay_loss:o,l1_decay_loss:a,cost_loss:n,softmax_loss:n,loss:n+a+o}}},t.Trainer=e,t.SGDTrainer=e}(s),function(t){"use strict";function e(t,e,i){i=i||{},void 0===t&&(t=[]),void 0===e&&(e=[]),this.data=t,this.labels=e,this.train_ratio=l(i,"train_ratio",.7),this.num_folds=l(i,"num_folds",10),this.num_candidates=l(i,"num_candidates",50),this.num_epochs=l(i,"num_epochs",50),this.ensemble_size=l(i,"ensemble_size",10),this.batch_size_min=l(i,"batch_size_min",10),this.batch_size_max=l(i,"batch_size_max",300),this.l2_decay_min=l(i,"l2_decay_min",-4),this.l2_decay_max=l(i,"l2_decay_max",2),this.learning_rate_min=l(i,"learning_rate_min",-4),this.learning_rate_max=l(i,"learning_rate_max",0),this.momentum_min=l(i,"momentum_min",.9),this.momentum_max=l(i,"momentum_max",.9),this.neurons_min=l(i,"neurons_min",5),this.neurons_max=l(i,"neurons_max",30),this.folds=[],this.candidates=[],this.evaluated_candidates=[],this.unique_labels=c(e),this.iter=0,this.foldix=0,this.finish_fold_callback=null,this.finish_batch_callback=null,0<this.data.length&&(this.sampleFolds(),this.sampleCandidates())}var i=t.randf,r=t.randi,n=t.Net,o=t.Trainer,a=t.maxmin,h=t.randperm,u=t.weightedSample,l=t.getopt,c=t.arrUnique;e.prototype={sampleFolds:function(){var t=this.data.length,e=Math.floor(this.train_ratio*t);this.folds=[];for(var i=0;i<this.num_folds;i++){var s=h(t);this.folds.push({train_ix:s.slice(0,e),test_ix:s.slice(e,t)})}},sampleCandidate:function(){var t=this.data[0].w.length,e=this.unique_labels.length,s=[];s.push({type:"input",out_sx:1,out_sy:1,out_depth:t});for(var a=u([0,1,2,3],[.2,.3,.3,.2]),h=0;h<a;h++){var l=r(this.neurons_min,this.neurons_max),c=["tanh","maxout","relu"][r(0,3)];if(i(0,1)<.5){var d=Math.random();s.push({type:"fc",num_neurons:l,activation:c,drop_prob:d})}else s.push({type:"fc",num_neurons:l,activation:c})}s.push({type:"softmax",num_classes:e});var _=new n;_.makeLayers(s);var f,p=r(this.batch_size_min,this.batch_size_max),y=Math.pow(10,i(this.l2_decay_min,this.l2_decay_max)),v=Math.pow(10,i(this.learning_rate_min,this.learning_rate_max)),m=i(this.momentum_min,this.momentum_max),g=i(0,1),w=new o(_,f=g<.33?{method:"adadelta",batch_size:p,l2_decay:y}:g<.66?{method:"adagrad",learning_rate:v,batch_size:p,l2_decay:y}:{method:"sgd",learning_rate:v,momentum:m,batch_size:p,l2_decay:y}),b={acc:[],accv:0};return b.layer_defs=s,b.trainer_def=f,b.net=_,b.trainer=w,b},sampleCandidates:function(){this.candidates=[];for(var t=0;t<this.num_candidates;t++){var e=this.sampleCandidate();this.candidates.push(e)}},step:function(){this.iter++;for(var t=this.folds[this.foldix],e=t.train_ix[r(0,t.train_ix.length)],i=0;i<this.candidates.length;i++){var s=this.data[e],a=this.labels[e];this.candidates[i].trainer.train(s,a)}var h=this.num_epochs*t.train_ix.length;if(this.iter>=h){var u=this.evalValErrors();for(i=0;i<this.candidates.length;i++)(l=this.candidates[i]).acc.push(u[i]),l.accv+=u[i];if(this.iter=0,this.foldix++,null!==this.finish_fold_callback&&this.finish_fold_callback(),this.foldix>=this.folds.length){for(i=0;i<this.candidates.length;i++)this.evaluated_candidates.push(this.candidates[i]);this.evaluated_candidates.sort((function(t,e){return t.accv/t.acc.length>e.accv/e.acc.length?-1:1})),this.evaluated_candidates.length>3*this.ensemble_size&&(this.evaluated_candidates=this.evaluated_candidates.slice(0,3*this.ensemble_size)),null!==this.finish_batch_callback&&this.finish_batch_callback(),this.sampleCandidates(),this.foldix=0}else for(i=0;i<this.candidates.length;i++){var l=this.candidates[i],c=new n;c.makeLayers(l.layer_defs);var d=new o(c,l.trainer_def);l.net=c,l.trainer=d}}},evalValErrors:function(){for(var t=[],e=this.folds[this.foldix],i=0;i<this.candidates.length;i++){for(var s=this.candidates[i].net,r=0,n=0;n<e.test_ix.length;n++){var o=this.data[e.test_ix[n]],a=this.labels[e.test_ix[n]];s.forward(o),r+=s.getPrediction()===a?1:0}r/=e.test_ix.length,t.push(r)}return t},predict_soft:function(t){var e,i,r=Math.min(this.ensemble_size,this.evaluated_candidates.length);if(0===r)return new s.Vol(0,0,0);for(var n=0;n<r;n++){var o=this.evaluated_candidates[n].net.forward(t);if(0===n)i=(e=o).w.length;else for(var a=0;a<i;a++)e.w[a]+=o.w[a]}for(a=0;a<i;a++)e.w[a]/=i;return e},predict:function(t){var e=this.predict_soft(t);if(0!==e.w.length)var i=a(e.w).maxi;else i=-1;return i},toJSON:function(){for(var t=Math.min(this.ensemble_size,this.evaluated_candidates.length),e={nets:[]},i=0;i<t;i++)e.nets.push(this.evaluated_candidates[i].net.toJSON());return e},fromJSON:function(t){this.ensemble_size=t.nets.length,this.evaluated_candidates=[];for(var e=0;e<this.ensemble_size;e++){var i=new n;i.fromJSON(t.nets[e]);var s={};s.net=i,this.evaluated_candidates.push(s)}},onFinishFold:function(t){this.finish_fold_callback=t},onFinishBatch:function(t){this.finish_batch_callback=t}},t.MagicNet=e}(s),function(e){"use strict";void 0===t.exports?window.jsfeat=e:t.exports=e}(s)},function(t,e,i){var s=i(16),r=i(17),n=i(18);t.exports=function(t){return s(t)||r(t)||n()}},function(t,e){t.exports=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}},function(t,e){function i(e,s){return t.exports=i=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},i(e,s)}t.exports=i},function(t,e){function i(e){return t.exports=i=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},i(e)}t.exports=i},function(t,e,i){var s,r;function n(){return(n=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=i[s])}return t}).apply(this,arguments)}function o(t){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}!function(n){"object"===o(e)&&void 0!==t?t.exports=n():void 0===(r="function"==typeof(s=n)?s.call(e,i,e,t):s)||(t.exports=r)}((function(){"use strict";function t(t,e){var i,s=new t(e);try{i=new CustomEvent("LazyLoad::Initialized",{detail:{instance:s}})}catch(t){(i=document.createEvent("CustomEvent")).initCustomEvent("LazyLoad::Initialized",!1,!1,{instance:s})}window.dispatchEvent(i)}function e(t,e){return t.getAttribute("data-"+e)}function i(t,e,i){var s="data-"+e;null!==i?t.setAttribute(s,i):t.removeAttribute(s)}function s(t){return"true"===e(t,"was-processed")}function r(t,e){return i(t,"ll-timeout",e)}function o(t){return e(t,"ll-timeout")}function a(t,e,i,s){t&&(void 0===s?void 0===i?t(e):t(e,i):t(e,i,s))}function h(t,e){t._loadingCount+=e,0===t._elements.length&&0===t._loadingCount&&a(t._settings.callback_finish,t)}function u(t){for(var e,i=[],s=0;e=t.children[s];s+=1)"SOURCE"===e.tagName&&i.push(e);return i}function l(t,e,i){i&&t.setAttribute(e,i)}function c(t,i){l(t,"sizes",e(t,i.data_sizes)),l(t,"srcset",e(t,i.data_srcset)),l(t,"src",e(t,i.data_src))}function d(t,e){L?t.classList.add(e):t.className+=(t.className?" ":"")+e}function _(t,e){L?t.classList.remove(e):t.className=t.className.replace(new RegExp("(^|\\s+)"+e+"(\\s+|$)")," ").replace(/^\s+/,"").replace(/\s+$/,"")}function f(t,e,i){t.addEventListener(e,i)}function p(t,e,i){t.removeEventListener(e,i)}function y(t,e,i){p(t,"load",e),p(t,"loadeddata",e),p(t,"error",i)}function v(t,e,i){var s=i._settings,r=e?s.class_loaded:s.class_error,n=e?s.callback_loaded:s.callback_error,o=t.target;_(o,s.class_loading),d(o,r),a(n,o,i),h(i,-1)}function m(t,e){var i=e._observer;z(t,e),i&&e._settings.auto_unobserve&&i.unobserve(t)}function g(t){var e=o(t);e&&(clearTimeout(e),r(t,null))}function w(t){return!!k&&(t._observer=new IntersectionObserver((function(e){e.forEach((function(e){return e.isIntersecting||0<e.intersectionRatio?function(t,e,i){var s=i._settings;a(s.callback_enter,t,e,i),(s.load_delay?function(t,e){var i=e._settings.load_delay,s=o(t);s||(s=setTimeout((function(){m(t,e),g(t)}),i),r(t,s))}:m)(t,i)}(e.target,e,t):function(e,i){var s=t._settings;a(s.callback_exit,e,i,t),s.load_delay&&g(e)}(e.target,e)}))}),{root:(e=t._settings).container===document?null:e.container,rootMargin:e.thresholds||e.threshold+"px"}),!0);var e}function b(t,e){return(i=t||function(t){return t.container.querySelectorAll(t.elements_selector)}(e),Array.prototype.slice.call(i)).filter((function(t){return!s(t)}));var i}function x(t,e){var s;this._settings=n({},A,t),this._loadingCount=0,w(this),this.update(e),s=this,S&&window.addEventListener("online",(function(t){!function(t){var e=t._settings;(function(t){return function(t){if(Array.isArray(t)){for(var e=0,i=new Array(t.length);e<t.length;e++)i[e]=t[e];return i}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()})(e.container.querySelectorAll("."+e.class_error)).forEach((function(t){_(t,e.class_error),i(t,"was-processed",null)})),t.update()}(s)}))}var S="undefined"!=typeof window,O=S&&!("onscroll"in window)||"undefined"!=typeof navigator&&/(gle|ing|ro)bot|crawl|spider/i.test(navigator.userAgent),k=S&&"IntersectionObserver"in window,L=S&&"classList"in document.createElement("p"),A={elements_selector:"img",container:O||S?document:null,threshold:300,thresholds:null,data_src:"src",data_srcset:"srcset",data_sizes:"sizes",data_bg:"bg",data_poster:"poster",class_loading:"loading",class_loaded:"loaded",class_error:"error",load_delay:0,auto_unobserve:!0,callback_enter:null,callback_exit:null,callback_reveal:null,callback_loaded:null,callback_error:null,callback_finish:null,use_native:!1},M={IMG:function(t,e){var i=t.parentNode;i&&"PICTURE"===i.tagName&&u(i).forEach((function(t){c(t,e)})),c(t,e)},IFRAME:function(t,i){l(t,"src",e(t,i.data_src))},VIDEO:function(t,i){u(t).forEach((function(t){l(t,"src",e(t,i.data_src))})),l(t,"poster",e(t,i.data_poster)),l(t,"src",e(t,i.data_src)),t.load()}},C=["IMG","IFRAME","VIDEO"],z=function(t,r,n){var o=r._settings;!n&&s(t)||(-1<C.indexOf(t.tagName)&&(function(t,e){function i(r){v(r,!0,e),y(t,i,s)}var s=function s(r){v(r,!1,e),y(t,i,s)};!function(t,e,i){f(t,"load",e),f(t,"loadeddata",e),f(t,"error",i)}(t,i,s)}(t,r),d(t,o.class_loading)),function(t,i){var s,r,n=i._settings,o=t.tagName,a=M[o];if(a)return a(t,n),h(i,1),i._elements=(s=i._elements,r=t,s.filter((function(t){return t!==r})));!function(t,i){var s=e(t,i.data_src),r=e(t,i.data_bg);s&&(t.style.backgroundImage='url("'.concat(s,'")')),r&&(t.style.backgroundImage=r)}(t,n)}(t,r),i(t,"was-processed","true"),a(o.callback_reveal,t,r),a(o.callback_set,t,r))},E=["IMG","IFRAME"];return x.prototype={update:function(t){var e,i=this,s=this._settings;this._elements=b(t,s),!O&&this._observer?(s.use_native&&"loading"in HTMLImageElement.prototype&&((e=this)._elements.forEach((function(t){-1!==E.indexOf(t.tagName)&&(t.setAttribute("loading","lazy"),z(t,e))})),this._elements=b(t,s)),this._elements.forEach((function(t){i._observer.observe(t)}))):this.loadAll()},destroy:function(){var t=this;this._observer&&(this._elements.forEach((function(e){t._observer.unobserve(e)})),this._observer=null),this._elements=null,this._settings=null},load:function(t,e){z(t,this,e)},loadAll:function(){var t=this;this._elements.forEach((function(e){m(e,t)}))}},S&&function(e,i){if(i)if(i.length)for(var s,r=0;s=i[r];r+=1)t(e,s);else t(e,i)}(x,window.lazyLoadOptions),x}))},function(t,e,i){"use strict";var s="bfred-it:object-fit-images",r=/(object-fit|object-position)\s*:\s*([-.\w\s%]+)/g,n="undefined"==typeof Image?{style:{"object-position":1}}:new Image,o="object-fit"in n.style,a="object-position"in n.style,h="background-size"in n.style,u="string"==typeof n.currentSrc,l=n.getAttribute,c=n.setAttribute,d=!1;function _(t,e,i){var s=function(t,e){return"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='"+t+"' height='"+e+"'%3E%3C/svg%3E"}(e||1,i||0);l.call(t,"src")!==s&&c.call(t,"src",s)}function f(t,e){t.naturalWidth?e(t):setTimeout(f,100,t,e)}function p(t){var e=function(t){for(var e,i=getComputedStyle(t).fontFamily,s={};null!==(e=r.exec(i));)s[e[1]]=e[2];return s}(t),i=t[s];if(e["object-fit"]=e["object-fit"]||"fill",!i.img){if("fill"===e["object-fit"])return;if(!i.skipTest&&o&&!e["object-position"])return}if(!i.img){i.img=new Image(t.width,t.height),i.img.srcset=l.call(t,"data-ofi-srcset")||t.srcset,i.img.src=l.call(t,"data-ofi-src")||t.src,c.call(t,"data-ofi-src",t.src),t.srcset&&c.call(t,"data-ofi-srcset",t.srcset),_(t,t.naturalWidth||t.width,t.naturalHeight||t.height),t.srcset&&(t.srcset="");try{!function(t){var e={get:function(e){return t[s].img[e||"src"]},set:function(e,i){return t[s].img[i||"src"]=e,c.call(t,"data-ofi-"+i,e),p(t),e}};Object.defineProperty(t,"src",e),Object.defineProperty(t,"currentSrc",{get:function(){return e.get("currentSrc")}}),Object.defineProperty(t,"srcset",{get:function(){return e.get("srcset")},set:function(t){return e.set(t,"srcset")}})}(t)}catch(e){window.console}}!function(t){if(t.srcset&&!u&&window.picturefill){var e=window.picturefill._;t[e.ns]&&t[e.ns].evaled||e.fillImg(t,{reselect:!0}),t[e.ns].curSrc||(t[e.ns].supported=!1,e.fillImg(t,{reselect:!0})),t.currentSrc=t[e.ns].curSrc||t.src}}(i.img),t.style.backgroundImage='url("'+(i.img.currentSrc||i.img.src).replace(/"/g,'\\"')+'")',t.style.backgroundPosition=e["object-position"]||"center",t.style.backgroundRepeat="no-repeat",t.style.backgroundOrigin="content-box",/scale-down/.test(e["object-fit"])?f(i.img,(function(){i.img.naturalWidth>t.width||i.img.naturalHeight>t.height?t.style.backgroundSize="contain":t.style.backgroundSize="auto"})):t.style.backgroundSize=e["object-fit"].replace("none","auto").replace("fill","100% 100%"),f(i.img,(function(e){_(t,e.naturalWidth,e.naturalHeight)}))}function y(t,e){var i=!d&&!t;if(e=e||{},t=t||"img",a&&!e.skipTest||!h)return!1;"img"===t?t=document.getElementsByTagName("img"):"string"==typeof t?t=document.querySelectorAll(t):"length"in t||(t=[t]);for(var r=0;r<t.length;r++)t[r][s]=t[r][s]||{skipTest:e.skipTest},p(t[r]);i&&(document.body.addEventListener("load",(function(t){"IMG"===t.target.tagName&&y(t.target,{skipTest:e.skipTest})}),!0),d=!0,t="img"),e.watchMQ&&window.addEventListener("resize",y.bind(null,t,{skipTest:e.skipTest}))}y.supportsObjectFit=o,y.supportsObjectPosition=a,function(){function t(t,e){return t[s]&&t[s].img&&("src"===e||"srcset"===e)?t[s].img:t}a||(HTMLImageElement.prototype.getAttribute=function(e){return l.call(t(this,e),e)},HTMLImageElement.prototype.setAttribute=function(e,i){return c.call(t(this,e),e,String(i))})}(),t.exports=y},function(t,e){function i(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}t.exports=function(t,e,s){return e&&i(t.prototype,e),s&&i(t,s),t}},function(t,e,i){var s=i(19),r=i(20);t.exports=function(t,e){return!e||"object"!==s(e)&&"function"!=typeof e?r(t):e}},function(t,e,i){var s=i(4);t.exports=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&s(t,e)}},function(t,e,i){var s=i(5),r=i(4),n=i(21),o=i(22);function a(e){var i="function"==typeof Map?new Map:void 0;return t.exports=a=function(t){if(null===t||!n(t))return t;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==i){if(i.has(t))return i.get(t);i.set(t,e)}function e(){return o(t,arguments,s(this).constructor)}return e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),r(e,t)},a(e)}t.exports=a},function(t,e,i){(function(e){var i=e.CustomEvent;t.exports=function(){try{var t=new i("cat",{detail:{foo:"bar"}});return"cat"===t.type&&"bar"===t.detail.foo}catch(t){}}()?i:"undefined"!=typeof document&&"function"==typeof document.createEvent?function(t,e){var i=document.createEvent("CustomEvent");return e?i.initCustomEvent(t,e.bubbles,e.cancelable,e.detail):i.initCustomEvent(t,!1,!1,void 0),i}:function(t,e){var i=document.createEventObject();return i.type=t,e?(i.bubbles=Boolean(e.bubbles),i.cancelable=Boolean(e.cancelable),i.detail=e.detail):(i.bubbles=!1,i.cancelable=!1,i.detail=void 0),i}}).call(this,i(23))},function(t,e){t.exports=function(){function t(t){return"function"==typeof t}function e(t){var e=function(t){var e=Number(t);return isNaN(e)?0:0!==e&&isFinite(e)?(0<e?1:-1)*Math.floor(Math.abs(e)):e}(t);return Math.min(Math.max(e,0),s)}function i(t){var e=t.next();return!Boolean(e.done)&&e}var s=Math.pow(2,53)-1;return function(s,r,n){"use strict";var o,a,h,u=1<arguments.length?r:void 0;if(void 0!==u){if(!t(u))throw new TypeError("Array.from: when provided, the second argument must be a function");2<arguments.length&&(o=n)}var l=function(e,i){if(null!=e&&null!=i){var s=e[i];if(null==s)return;if(!t(s))throw new TypeError(s+" is not a function");return s}}(s,function(t){if(null!=t){if(-1<["string","number","boolean","symbol"].indexOf(typeof t))return Symbol.iterator;if("undefined"!=typeof Symbol&&"iterator"in Symbol&&Symbol.iterator in t)return Symbol.iterator;if("@@iterator"in t)return"@@iterator"}}(s));if(void 0!==l){a=t(this)?Object(new this):[];var c,d,_=l.call(s);if(null==_)throw new TypeError("Array.from requires an array-like or iterable object");for(h=0;;){if(!(c=i(_)))return a.length=h,a;d=c.value,a[h]=u?u.call(o,d,h):d,h++}}else{var f=Object(s);if(null==s)throw new TypeError("Array.from requires an array-like object - not null or undefined");var p,y=e(f.length);for(a=t(this)?Object(new this(y)):new Array(y),h=0;h<y;)p=f[h],a[h]=u?u.call(o,p,h):p,h++;a.length=y}return a}}()},function(t,e,i){"use strict";i(15).polyfill()},function(t,e,i){"use strict";function s(t,e){if(null==t)throw new TypeError("Cannot convert first argument to object");for(var i=Object(t),s=1;s<arguments.length;s++){var r=arguments[s];if(null!=r)for(var n=Object.keys(Object(r)),o=0,a=n.length;o<a;o++){var h=n[o],u=Object.getOwnPropertyDescriptor(r,h);void 0!==u&&u.enumerable&&(i[h]=r[h])}}return i}t.exports={assign:s,polyfill:function(){Object.assign||Object.defineProperty(Object,"assign",{enumerable:!1,configurable:!0,writable:!0,value:s})}}},function(t,e){t.exports=function(t){if(Array.isArray(t)){for(var e=0,i=new Array(t.length);e<t.length;e++)i[e]=t[e];return i}}},function(t,e){t.exports=function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}},function(t,e){t.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}},function(t,e){function i(e){return"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?t.exports=i=function(t){return typeof t}:t.exports=i=function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},i(e)}t.exports=i},function(t,e){t.exports=function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}},function(t,e){t.exports=function(t){return-1!==Function.toString.call(t).indexOf("[native code]")}},function(t,e,i){var s=i(4);function r(e,i,n){return function(){if("undefined"!=typeof Reflect&&Reflect.construct&&!Reflect.construct.sham){if("function"==typeof Proxy)return 1;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),1}catch(t){return}}}()?t.exports=r=Reflect.construct:t.exports=r=function(t,e,i){var r=[null];r.push.apply(r,e);var n=new(Function.bind.apply(t,r));return i&&s(n,i.prototype),n},r.apply(null,arguments)}t.exports=r},function(t,e){var i;i=function(){return this}();try{i=i||new Function("return this")()}catch(t){"object"==typeof window&&(i=window)}t.exports=i},,function(t,e,i){"use strict";i.r(e);var s=i(0),r=i.n(s),n=i(6),o=i.n(n),a=(i(14),i(7)),h=i.n(a),u=i(3),l=i.n(u),c=i(8),d=i.n(c),_=i(1),f=i.n(_),p=(i(2),i(9)),y=(i.n(p),i(5)),v=(i.n(y),i(10)),m=(i.n(v),i(11)),g=i.n(m),w=i(12),b=i.n(w);function x(t,e){if(t)if(NodeList.prototype.isPrototypeOf(t)||Array.prototype.isPrototypeOf(t))r()(t).forEach((function(t){return x(t,e)}));else{var i=(t.getAttribute("class")||"").split(" ").filter(Boolean).filter((function(t){return t!==e}));t.setAttribute("class",i.join(" "))}}HTMLElement.prototype.getCompatibleBoundingClientRect=function(){var t=HTMLElement.prototype.getBoundingClientRect;return function(){try{return t.apply(this)}catch(t){return{left:"",right:"",top:"",bottom:""}}}}(),g()(Error);var S=function(){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};l()(this,t),this.element=e.element,this.uploadWrapper=this.element.querySelector(".mod--script-container__upload__wrapper"),this.upload=this.element.querySelector("#mod--script-container__upload__input"),this.colorSelectWrapper=this.element.querySelector(".mod--script-container__color-select__wrapper"),this.colorAddButton=this.element.querySelector(".color-add"),this.colorOverviewWrapper=this.element.querySelector(".mod--script-container__color-overview__wrapper"),this.reportDiv=this.element.querySelector(".mod--script-container__report"),this.imageCanvas=this.element.querySelector("#canvas--image"),this.netCanvas=this.element.querySelector("#canvas--net"),this.colorCanvas=this.element.querySelector("#canvas--color"),this.outlineCanvas=this.element.querySelector("#canvas--outline"),this.downloadsWrapper=this.element.querySelector(".mod--script-container__downloads"),this.polygonArray=[],this.json=this.element.querySelector("#colors-json").innerHTML,this.defaultWidth=500,this.defaultHeight=null,this.batchesPerIteration=100,this.smoothLoss=-1,this.drawingCount=100,this.maxIterations=100,this.colorArray=[]}return d()(t,[{key:"init",value:function(){this.initEvents(),this.addColorFunctions()}},{key:"initEvents",value:function(){var t=this;window.addEventListener("color-swatch-added",(function(e){t.updateColors()}))}},{key:"updateColors",value:function(){var t=this;x(this.colorOverviewWrapper,"hidden"),this.colorOverviewWrapper.innerHTML="",this.colorArray.forEach((function(e){var i='\n        <div class="swatch-item">\n          <div class="swatch-item__swatch" style="background: rgb('.concat(e.r,", ").concat(e.g,", ").concat(e.b,');"></div>\n          <div class="swatch-item__name">').concat(e.name,"</div>\n        </div>\n      ");t.colorOverviewWrapper.innerHTML+=i})),1<this.colorArray.length&&x(this.uploadWrapper,"hidden")}},{key:"addColorFunctions",value:function(){var t=this;this.brands=JSON.parse(this.json).brands,this.colorAddButton.addEventListener("click",(function(){var e=r()(t.colorSelectWrapper.querySelectorAll(".color-select__holder")).length,i='\n        <div class="color-select__holder" data-index="'.concat(e,'">\n          <div class="color-select__index"><span>').concat(e+1,'</span></div>\n          <div class="color-select__brand"></div>\n          <div class="color-select__color"></div>\n          <div class="color-select__amount"></div>\n          <div class="color-select__append"></div>\n        </div>\n      ');t.colorSelectWrapper.insertAdjacentHTML("beforeend",i);var s="<select>";s+='\n        <option value="" disabled selected>Marke wählen</option>\n      ',t.brands.forEach((function(t){var e='<option value="'.concat(t.brand,'">').concat(t.brand,"</option>");s+=e})),s+="</select>";var n=t.colorSelectWrapper.querySelector('[data-index="'.concat(e,'"]')),o=n.querySelector(".color-select__brand");o.innerHTML="",o.innerHTML+=s,o.addEventListener("change",(function(i){var s="<select>";s+='\n          <option value="" disabled selected>Farbe wählen</option>\n        ';var r=t.brands.find((function(t){return t.brand===i.target.value}));r.colors.forEach((function(t){var e='<option value="'.concat(t.title,'">').concat(t.title,"</option>");s+=e})),s+="</select>";var o=n.querySelector(".color-select__color");o.innerHTML="",o.innerHTML+=s,o.querySelector("select").addEventListener("change",(function(i){var s=i.target.value,o=document.createElement("input");o.type="text",n.querySelector(".color-select__amount").innerHTML="",n.querySelector(".color-select__amount").appendChild(o);var a=document.createElement("button");a.innerHTML="Farbe Hinzufügen",n.querySelector(".color-select__append").innerHTML="",n.querySelector(".color-select__append").appendChild(a),a.addEventListener("click",(function(){var i=r.colors.find((function(t){return t.title===s}));t.colorArray.push({title:i.title,name:e+1,r:"HEX"===i.color.type?t.hexToRgb(i.color.value).r:i.color.r,g:"HEX"===i.color.type?t.hexToRgb(i.color.value).g:i.color.g,b:"HEX"===i.color.type?t.hexToRgb(i.color.value).b:i.color.b,amount:Number(o.value)||100}),function(t,e){var i=new b.a("color-swatch-added",{detail:{}});window.dispatchEvent(i)}()}))}))}))})),this.initUpload()}},{key:"initUpload",value:function(){var t=this;this.upload.onchange=function(e){Promise.resolve().then((function(){return t.initFileReader(e.target.files[0])}))}}},{key:"initFileReader",value:function(t){var e=this;return new Promise((function(i,s){var r=new FileReader;r.onload=function(){e.file=r.result,e.placeOriginal(e.file)},r.readAsDataURL(t)}))}},{key:"placeOriginal",value:function(){var t=this,e=new Image;e.src=this.file,e.onload=function(){t.ratio=t.defaultWidth/e.width,t.defaultHeight=e.height*t.ratio,t.imageCanvas.width=t.defaultWidth,t.imageCanvas.height=t.defaultHeight,t.netCanvas.width=t.defaultWidth,t.netCanvas.height=t.defaultHeight,t.imageContext=t.imageCanvas.getContext("2d"),t.netContext=t.netCanvas.getContext("2d"),t.imageContext.drawImage(e,0,0,t.defaultWidth,t.defaultHeight),t.originalData=t.imageContext.getImageData(0,0,t.defaultWidth,t.defaultHeight),t.reload(),t.interval=setInterval((function(){t.tick()}),1)}}},{key:"reload",value:function(){this.counter=0;var t=[];t.push({type:"input",out_sx:1,out_sy:1,out_depth:2});for(var e=0;e<5;e+=1)t.push({type:"fc",num_neurons:20,activation:"relu"});t.push({type:"regression",num_neurons:3}),this.net=new f.a.Net,this.net.makeLayers(t),this.trainer=new f.a.SGDTrainer(this.net,{learning_rate:.01,momentum:.9,batch_size:5,l2_decay:0})}},{key:"tick",value:function(){this.update(),this.draw(),this.counter+=1}},{key:"update",value:function(){this.defaultHeight=this.netCanvas.height;for(var t=this.originalData.data,e=new f.a.Vol(1,1,2),i=0,s=0,r=0;r<this.trainer.batch_size;r+=1)for(var n=0;n<this.batchesPerIteration;n+=1){var o=f.a.randi(0,this.defaultWidth),a=f.a.randi(0,this.defaultHeight),h=4*(this.defaultWidth*a+o),u=[t[h]/255,t[1+h]/255,t[2+h]/255];e.w[0]=(o-this.defaultWidth/2)/this.defaultWidth,e.w[1]=(a-this.defaultHeight/2)/this.defaultHeight,i+=this.trainer.train(e,u).loss,s+=1}i/=s,0===this.counter?this.smoothLoss=i:this.smoothLoss=.99*this.smoothLoss+.01*i;var l="Net Loss: ".concat(this.smoothLoss,"<br/>Net Iteration: ").concat(this.counter);this.reportDiv.innerHTML=l,x(this.reportDiv,"hidden")}},{key:"draw",value:function(){if(this.counter%this.drawingCount==0){if(this.counter>=this.maxIterations)return clearInterval(this.interval),void this.filter();for(var t=this.netCanvas.width,e=this.netCanvas.height,i=this.netContext.getImageData(0,0,t,e),s=new f.a.Vol(1,1,2),r=0;r<t;r+=1){s.w[0]=(r-t/2)/t;for(var n=0;n<e;n+=1){s.w[1]=(n-e/2)/e;var o=4*(t*n+r),a=this.net.forward(s);i.data[0+o]=Math.floor(255*a.w[0]),i.data[1+o]=Math.floor(255*a.w[1]),i.data[2+o]=Math.floor(255*a.w[2]),i.data[3+o]=255}}this.netContext.putImageData(i,0,0)}}},{key:"filter",value:function(){var t=this.netContext.getImageData(0,0,this.defaultWidth,this.defaultHeight);this.replaceColors(t)}},{key:"replaceColors",value:function(t){var e=this,i=t.data,s=[];this.colorArray.forEach((function(t){s.push({hue:e.returnHSL(t.r,t.g,t.b).hue,saturation:e.returnHSL(t.r,t.g,t.b).saturation,lightness:e.returnHSL(t.r,t.g,t.b).lightness})}));for(var r=[],n=0;n<this.colorArray.length;n+=1)r[n]=0;for(var o=0;o<i.length;o+=4){for(var a=i[o],h=i[o+1],u=i[o+2],l=this.returnHSL(a,h,u),c=0;c<r.length;c+=1)l.hue<=360/r.length*c&&(r[c]+=1);for(var d=r.sort((function(t,e){return t-e})),_=[],f=0;f<d.length;f+=1)_[f]=this.colorArray.sort((function(t,e){return t.amount-e.amount})).reverse()[f];for(var p=1;p<=d.length;p+=1){var y=p-1==-1?0:p-1,v=p;l.hue<=360/_.length*v&&l.hue>=360/_.length*y&&(i[o]=_[p-1].r,i[o+1]=_[p-1].g,i[o+2]=_[p-1].b)}}this.colorCanvas.width=this.netCanvas.width,this.colorCanvas.height=this.netCanvas.height,this.colorContext=this.colorCanvas.getContext("2d"),this.colorContext.putImageData(new ImageData(i,this.netCanvas.width,this.netCanvas.height),0,0),this.getOutline(this.colorCanvas.getContext("2d"))}},{key:"returnHSL",value:function(t,e,i){t/=255,e/=255,i/=255;var s=Math.min(t,e,i),r=Math.max(t,e,i),n=r-s,o=0,a=0;return o=0==n?0:r==t?(e-i)/n%6:r==e?(i-t)/n+2:(t-e)/n+4,(o=Math.round(60*o))<0&&(o+=360),a=(r+s)/2,{hue:o,saturation:+(100*(0==n?0:n/(1-Math.abs(2*a-1)))).toFixed(1),lightness:a=+(100*a).toFixed(1)}}},{key:"getOutline",value:function(t){var e=t.getImageData(0,0,this.defaultWidth,this.defaultHeight),i=0,s=0,r=void 0,n=void 0,o=void 0,a=void 0;for(this.outlineCanvas.width=this.defaultWidth,this.outlineCanvas.height=this.defaultHeight,s=0;s<this.defaultHeight;s+=1)for(i=0;i<this.defaultWidth;i+=1){var h=4*(i+s*this.defaultWidth),u=this.returnHSL(e.data[h],e.data[1+h],e.data[2+h]),l=4*(i-1+s*this.defaultWidth),c=4*(i+1+s*this.defaultWidth),d=4*(i+(s-1)*this.defaultWidth),_=4*(i+(s+1)*this.defaultWidth);i%Math.floor(this.defaultWidth/30)==0&&s%Math.floor(this.defaultWidth/30)==0&&this.plotText(i,s,this.outlineCanvas,u),r=this.returnHSL(e.data[l],e.data[1+l],e.data[2+l]),o=this.returnHSL(e.data[c],e.data[1+c],e.data[2+c]),n=this.returnHSL(e.data[d],e.data[1+d],e.data[2+d]),a=this.returnHSL(e.data[_],e.data[1+_],e.data[2+_]),u.hue===r.hue&&u.hue===o.hue&&u.hue===a.hue&&u.hue===n.hue||this.plotPoint(i,s,this.outlineCanvas)}this.createPolygon()}},{key:"plotPoint",value:function(t,e,i){i.getContext("2d").fillStyle="black",i.getContext("2d").fillRect(t,e,1,1),i.getContext("2d").fill()}},{key:"plotText",value:function(t,e,i,s){var r=this,n=this.colorArray.find((function(t){return r.returnHSL(t.r,t.g,t.b).hue===s.hue&&r.returnHSL(t.r,t.g,t.b).saturation===s.saturation})).name,o=i.getContext("2d");o.font="15px Courier New",o.fillStyle="black",o.textAlign="center",o.fillText(n,t,e+7)}},{key:"createPolygon",value:function(){var t=this,e=this.outlineCanvas.getContext("2d"),i=e.getImageData(0,0,this.defaultWidth,this.defaultHeight);this.outlineCanvas.width=this.defaultWidth,this.outlineCanvas.height=this.defaultHeight||266,this.widthThirds=this.defaultWidth/3,this.heightThirds=this.defaultHeight/3;for(var s=0;s<6;s+=1)if(0===s){var r=[];r.push(this.getRandomInt(100,+this.widthThirds)),r.push(this.getRandomInt(100,+this.heightThirds)),this.polygonArray.push(r)}else if(1===s||2===s){var n=[];n.push(this.getRandomInt(2*this.widthThirds,this.defaultWidth-100)),n.push(this.getRandomInt(100,+this.heightThirds)),this.polygonArray.push(n)}else if(3===s){var o=[];o.push(this.getRandomInt(2*this.widthThirds,this.defaultWidth-100)),o.push(this.getRandomInt(this.height-100,2*this.heightThirds+100)),this.polygonArray.push(o)}else{var a=[];a.push(this.getRandomInt(100,+this.widthThirds)),a.push(this.getRandomInt(100,2*this.heightThirds+100)),this.polygonArray.push(a)}if(0!==this.polygonArray.length){var h=this.outlineCanvas.getContext("2d");h.save(),h.beginPath(),this.polygonArray.forEach((function(e,i){0===i?h.moveTo(e[0],e[1]):i===t.polygonArray.length-1?h.lineTo(t.polygonArray[0][0],t.polygonArray[0][1]):h.lineTo(e[0],e[1])})),h.stroke(),h.clip(),h.globalCompositeOperation="destination-atop",e.putImageData(i,0,0),h.restore()}this.createDownload()}},{key:"getRandomInt",value:function(t,e){return t=Math.ceil(t),e=Math.floor(e),Math.floor(Math.random()*(e-t))+t}},{key:"createDownload",value:function(){var t=this;r()(this.element.querySelectorAll("canvas")).forEach((function(e){var i=document.createElement("a"),s=e.id.split("--")[1];i.setAttribute("download","".concat((new Date).toLocaleDateString("de-DE"),"__").concat(s,".png")),i.setAttribute("href",e.toDataURL("image/png").replace("image/png","image/octet-stream")),i.innerHTML="Download ".concat(s.toUpperCase()),t.element.appendChild(i)}))}},{key:"hexToRgb",value:function(t){var e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return e?{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)}:null}}]),t}();h()(),window.sharedObjects=window.sharedObjects||{},document.addEventListener("DOMContentLoaded",(function(){!function(){var t=function(){var t={ScriptContainer:S},e=window.classesAdditional||{};return Object.assign({},t,e)}(),e=document.querySelectorAll("[data-module]");window.initializedModuleInstances=r()(e).map((function(e){var i=e.getAttribute("data-module");try{if(""===i)return null;var s=new t[i]({element:e});return s.init(),s}catch(e){return null}}))}(),new o.a({elements_selector:".lazy img, img.lazy",treshold:300})}))}]);
//# sourceMappingURL=bundle.js.map